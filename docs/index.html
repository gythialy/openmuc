<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>OpenMUC User Guide</title>
<style>
/*
 * AsciiDoc 'volnitsky' theme for xhtml11 and html5 backends.
 * Based on css from http://volnitsky.com, which was in turn based on default
 * theme from AsciiDoc
 *
 * FIXME: The styling is still a bit rough in places.
 *
 */

/* Default font. */
body {
  font-family: Helvetica, sans-serif;
  max-width:62.5em;
  margin: auto;
}

/* Title font. */

h1, h2, h3, h4, h5, h6 {
    clear: both;
    font-family: Helvetica, serif;
    line-height: 1.3;
}

a {
    border-bottom: 1px dotted #999999;
    color: #378f03 !important;
    text-decoration: none !important;
}
a:hover {
    border-bottom: 1px solid #378f03;
    color: #378f03 !important;
    text-decoration: none !important;
}

em {
  font-style: italic;
  color: #4E4E4E;
}

strong {
  font-weight: bold;
  color: #000000;
}


div.sectionbody {
/*  margin-left: 0;*/
}

hr {
  border: 1px solid #575757;
}


pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #575757;
  font-weight: bold;
  font-size: 1.1em;
}

#footer {
  font-size: small;
  padding-top: 0.5em;
  margin-top: 4.0em;
}

#footer-text {
  float: left;
  padding-bottom: 0.5em;
}

#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}

div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}

div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #575757;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.verseblock > pre.content {
  font-family: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #575757;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: #575757;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #575757;
}
thead {
  font-weight: bold;
  color: #575757;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: #575757;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

@media print {
  #footer-badges { display: none; }
}

#toctitle {
  color: #575757;
  font-size: 1.2em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 { margin-top: 0; margin-bottom: 0; }
div.toclevel1 { margin-top: 0.3em; margin-left: 0; font-size: 1.0em; }
div.toclevel2 { margin-top: 0.25em; margin-left: 2em; font-size: 0.9em; }
div.toclevel3 { margin-left: 4em; font-size: 0.8em; }
div.toclevel4 { margin-left: 6em; font-size: 0.8em; }



.monospaced, tt, div.listingblock > div.content {
  font-family:  Consolas, "Andale Mono", "Courier New", monospace;
  color: #004400;
  background: #f4f4f4;
  max-width: 80em;
  line-height: 1.2em;
}

.paragraph p  {
  line-height: 1.5em;
  margin-top: 1em;
}

/*.paragraph p, li, dd, .content { max-width: 85em; }
.admonitionblock               { max-width: 35em; }*/

div.sectionbody div.ulist > ul > li {
  list-style-type: square;
  color: #aaa;
}
  div.sectionbody div.ulist >  ul > li > * {
    color: black;
    /*font-size: 50%;*/
  }


div.sectionbody div.ulist > ul > li div.ulist > ul > li {
  color: #ccd ;
}
  div.sectionbody div.ulist > ul > li div.ulist > ul > li > * {
    color: black ;
  }

/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #575757;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #575757;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #575757;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}



</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>OpenMUC User Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_intro">1. Intro</a></li>
<li><a href="#_quick_start">2. Quick Start</a>
<ul class="sectlevel2">
<li><a href="#_install_openmuc">2.1. Install OpenMUC</a></li>
<li><a href="#_start_the_demo">2.2. Start the Demo</a></li>
<li><a href="#_webui_walk_through">2.3. WebUI Walk Through</a></li>
</ul>
</li>
<li><a href="#_tutorials">3. Tutorials</a>
<ul class="sectlevel2">
<li><a href="#_build_a_simple_m_bus_data_logger">3.1. Build a Simple M-Bus Data Logger</a></li>
<li><a href="#_develop_a_customised_application">3.2. Develop a Customised Application</a></li>
<li><a href="#anchor-tutorial-webui-plugin">3.3. Develop a Customised WebUI Plugin</a></li>
</ul>
</li>
<li><a href="#anchor-architecture">4. Architecture</a>
<ul class="sectlevel2">
<li><a href="#_file_structure_of_the_distribution">4.1. File Structure of the Distribution</a></li>
<li><a href="#_folder_framework">4.2. Folder framework/</a></li>
<li><a href="#_devices_and_channels">4.3. Devices and Channels</a></li>
<li><a href="#anchor-configuration">4.4. Configuration via channels.xml</a></li>
<li><a href="#_sampling_listening_and_logging">4.5. Sampling, Listening and Logging</a></li>
</ul>
</li>
<li><a href="#anchor-start-script">5. OpenMUC Start Script</a>
<ul class="sectlevel2">
<li><a href="#_start_openmuc">5.1. Start OpenMUC</a></li>
<li><a href="#_stop_openmuc">5.2. Stop OpenMUC</a></li>
<li><a href="#_restart_openmuc">5.3. Restart OpenMUC</a></li>
<li><a href="#_reload_openmuc_configuration">5.4. Reload OpenMUC Configuration</a></li>
<li><a href="#_update_bundles">5.5. Update Bundles</a></li>
<li><a href="#_remote_shell">5.6. Remote Shell</a></li>
<li><a href="#_auto_start_at_boot_time">5.7. Auto Start at Boot Time</a></li>
</ul>
</li>
<li><a href="#_drivers">6. Drivers</a>
<ul class="sectlevel2">
<li><a href="#_install_a_driver">6.1. Install a Driver</a></li>
<li><a href="#_modbus">6.2. Modbus</a></li>
<li><a href="#anchor-driver-mbus">6.3. M-Bus (wired)</a></li>
<li><a href="#_m_bus_wireless">6.4. M-Bus (wireless)</a></li>
<li><a href="#_iec_60870_5_104">6.5. IEC 60870-5-104</a></li>
<li><a href="#_iec_61850">6.6. IEC 61850</a></li>
<li><a href="#_iec_62056_part_21">6.7. IEC 62056 part 21</a></li>
<li><a href="#_dlmscosem">6.8. DLMS/COSEM</a></li>
<li><a href="#_knx">6.9. KNX</a></li>
<li><a href="#_ehz">6.10. eHZ</a></li>
<li><a href="#_snmp">6.11. SNMP</a></li>
<li><a href="#_csv">6.12. CSV</a></li>
<li><a href="#_aggregator">6.13. Aggregator</a></li>
<li><a href="#_restjson">6.14. REST/JSON</a></li>
<li><a href="#_amqp">6.15. AMQP</a></li>
<li><a href="#_mqtt">6.16. MQTT</a></li>
</ul>
</li>
<li><a href="#anchor-dataloggers">7. Dataloggers</a>
<ul class="sectlevel2">
<li><a href="#_ascii_logger">7.1. ASCII Logger</a></li>
<li><a href="#_amqp_logger">7.2. AMQP Logger</a></li>
<li><a href="#_mqtt_logger">7.3. MQTT Logger</a></li>
<li><a href="#_slotsdb_logger">7.4. SlotsDB Logger</a></li>
<li><a href="#_sql_logger">7.5. SQL Logger</a></li>
</ul>
</li>
<li><a href="#anchor-libraries">8. Libraries</a>
<ul class="sectlevel2">
<li><a href="#_amqp_2">8.1. AMQP</a></li>
<li><a href="#_mqtt_2">8.2. MQTT</a></li>
<li><a href="#_osgi">8.3. OSGI</a></li>
<li><a href="#parser-lib">8.4. Parser-Service</a></li>
<li><a href="#anchor-lib-ssl">8.5. SSL</a></li>
</ul>
</li>
<li><a href="#anchor-web-ui">9. WebUI</a>
<ul class="sectlevel2">
<li><a href="#_plugins">9.1. Plugins</a></li>
<li><a href="#_context_root">9.2. Context Root</a></li>
<li><a href="#_https">9.3. HTTPS</a></li>
<li><a href="#_custom_plugins">9.4. Custom Plugins</a></li>
<li><a href="#_visualisation">9.5. Visualisation</a></li>
</ul>
</li>
<li><a href="#id_restful_web_services">10. REST Server</a>
<ul class="sectlevel2">
<li><a href="#_requirements">10.1. Requirements</a></li>
<li><a href="#_accessing_channels">10.2. Accessing channels</a></li>
<li><a href="#_cors">10.3. CORS</a></li>
</ul>
</li>
<li><a href="#id_modbus_service">11. Modbus Server</a>
<ul class="sectlevel2">
<li><a href="#_example">11.1. Example</a></li>
</ul>
</li>
<li><a href="#_tools">12. Tools</a>
<ul class="sectlevel2">
<li><a href="#_apache_felix_web_console">12.1. Apache Felix Web Console</a></li>
</ul>
</li>
<li><a href="#_authors">13. Authors</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_intro">1. Intro</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenMUC is a software framework based on Java and OSGi that simplifies the development of customized monitoring, logging and control systems.
It can be used as a basis to flexibly implement anything from simple data loggers to complex SCADA systems.
The main goal of OpenMUC is to shield the application developer of monitoring and control applications from the details of the communication protocol and data logging technologies.
Third parties are encouraged to create their own customized systems based on OpenMUC.
OpenMUC is licensed under the GPL.
If you need an individual license please
<a href="https://www.openmuc.org/contact/">contact</a> us.</p>
</div>
<div class="paragraph">
<p>For a short overview of OpenMUC&#8217;s goals and features please visit our
<a href="https://www.openmuc.org/openmuc/">overview page</a>.
This guide is a detailed documentation on how OpenMUC works and how to use it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quick_start">2. Quick Start</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter will give you an idea of how OpenMUC works by showing you how to run and adjust the demo framework which is part of the OpenMUC distribution.</p>
</div>
<div class="sect2">
<h3 id="_install_openmuc">2.1. Install OpenMUC</h3>
<div class="paragraph">
<p>To install OpenMUC just download the <a href="https://www.openmuc.org/openmuc/download/">latest version</a>
and unpack it to your favorite destination.</p>
</div>
<div class="paragraph">
<p>OpenMUC requires Java 8 or higher, therefore make sure it is installed on your machine.</p>
</div>
</div>
<div class="sect2">
<h3 id="_start_the_demo">2.2. Start the Demo</h3>
<div class="paragraph">
<p>The OpenMUC demo contains a simple application which demonstrates how you can access channels and their records from an application.
The application reads data from channels of the CSV driver, calculates new values from them and writes them to other channels.
The application can be used as starting point to create your own OpenMUC application.</p>
</div>
<div class="paragraph">
<p>Open a terminal and navigate to the framework folder <em>(&lt;your-path&gt;/openmuc/framework)</em></p>
</div>
<div class="paragraph">
<p>To start OpenMUC on Linux run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc start -fg</pre>
</div>
</div>
<div class="paragraph">
<p>To start OpenMUC on Windows run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bin\openmuc.bat</pre>
</div>
</div>
<div class="paragraph">
<p>This will start the Apache Felix OSGi framework which in turn starts all the bundles located in the "bundle" folder.
After initialization of the OSGi framework you should be able to see the output of the demo application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
17:33:00.011 INFO SimpleDemoApp - home1: current grid power = -4.672 kW
17:33:05.006 INFO SimpleDemoApp - home1: current grid power = -4.666 kW
17:33:10.007 INFO SimpleDemoApp - home1: current grid power = -4.671 kW
...</pre>
</div>
</div>
<div class="paragraph">
<p>Among the bundles that are started is the Apache Gogo shell.
This shell is entered once you run OpenMUC.
Now type <code>lb</code> to list all installed bundles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>START LEVEL 1
   ID|State      |Level|Name
    0|Active     |    0|System Bundle
    ...
    7|Active     |    1|Logback Core Module
    8|Active     |    1|OpenMUC App - Simple Demo
    9|Active     |    1|OpenMUC Core - API
   10|Active     |    1|OpenMUC Core - Data Manager
   11|Active     |    1|OpenMUC Core - SPI
   12|Active     |    1|OpenMUC Data Logger - ASCII
   13|Active     |    1|OpenMUC Data Logger - SlotsDB
   14|Active     |    1|OpenMUC Driver - CSV
   15|Active     |    1|OpenMUC Server - RESTful Web Service
   16|Active     |    1|OpenMUC WebUI - Base
   17|Active     |    1|OpenMUC WebUI - Channel Access Tool
   ...</pre>
</div>
</div>
<div class="paragraph">
<p>You can stop and exit the OSGi framework any time by typing <code>ctrl+d</code> or <code>stop 0</code>.
For more information about the start script see chapter <a href="#anchor-start-script">OpenMUC Start Script</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_webui_walk_through">2.3. WebUI Walk Through</h3>
<div class="paragraph">
<p>This section leads you through the framework&#8217;s WebUI.</p>
</div>
<div class="paragraph">
<p>Open a browser (works currently best with Google Chrome) and enter the URL "http://localhost:8888".
This leads you to the login page.
The default user is <em>admin</em> and the default password is <em>admin</em> as well.</p>
</div>
<div class="paragraph">
<p>After successful login the OpenMUC Dashboard opens, which provides various plugins for configuration and visualization.
A full description of the plugins can be found in the chapter
<a href="#anchor-web-ui">Web UI</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/webui-dashboard.png"><img src="./images/webui-dashboard.png" alt="webui dashboard" width="60%"></a>
</div>
<div class="title">Figure 1. WebUI Dashboard</div>
</div>
<div class="paragraph">
<p>Let us first look at the Channel Access Tool which provides the current value of each channel and also enables you to write values.
Click on Channel Access Tool to open this plugin.
The next page lists all available devices which are currently configured in OpenMUC.
Select the <em>home1</em> and proceed with <em>Access selected</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/webui-channelaccesstool-device-selection.png"><img src="./images/webui-channelaccesstool-device-selection.png" alt="webui channelaccesstool device selection" width="60%"></a>
</div>
<div class="title">Figure 2. WebUI device selection</div>
</div>
<div class="paragraph">
<p>On the next page you will see the latest records of all channels of home1. Each record consists of a data value, a timestamp when it was sampled and a quality flag.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/webui-channelaccesstool-channels.png"><img src="./images/webui-channelaccesstool-channels.png" alt="webui channelaccesstool channels" width="60%"></a>
</div>
<div class="title">Figure 3. WebUI channel access tool</div>
</div>
<div class="paragraph">
<p>Let&#8217;s have look at the <em>Data Plotter</em>.
To get to the <em>Data Plotter</em> click on <em>Applications</em> next to the OpenMUC logo and select <em>Data Plotter</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/webui-dataplotter.png"><img src="./images/webui-dataplotter.png" alt="webui dataplotter" width="60%"></a>
</div>
<div class="title">Figure 4. WebUI data plotter</div>
</div>
<div class="paragraph">
<p>Select the <em>Live</em> Data Plotter.
To view the live data select the channels of your choice and click <em>Plot Data</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/webui-dataplotter-live.png"><img src="./images/webui-dataplotter-live.png" alt="webui dataplotter live" width="60%"></a>
</div>
<div class="title">Figure 5. WebUI live plotter</div>
</div>
<div class="paragraph">
<p>The last WebUI plugin we want to look at is a customised visualisation for our demo application.
Click on <em>Applications</em> and select <em>Simple Demo Visualisation</em>.
The purpose of this plugin is to show how OpenMUC channels can be accessed and used for individual visualisations.
Detailed informations about the development of such a plugin can be found in the
<a href="#anchor-tutorial-webui-plugin">Tutorial Develop a Customised WebUI Plugin</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/simpleDemoVisualisation.png"><img src="./images/simpleDemoVisualisation.png" alt="simpleDemoVisualisation" width="60%"></a>
</div>
<div class="title">Figure 6. WebUI customized visualization</div>
</div>
<div class="sect3">
<h4 id="_add_a_new_channel">2.3.1. Add a New Channel</h4>
<div class="paragraph">
<p>All channels currently defined get their data using the CSV driver from the file "csv-driver/home1.csv".
That file contains additional data.
So let us now add a new channel to the OpenMUC configuration using the channel scan feature.</p>
</div>
<div class="paragraph">
<p>In the WebUI go to the Channel Configurator.
Click the tab "Devices".
In the row of device "home1" click on the search/scan icon.
It shows you all the channels available in that device.
Once the scan has completed a list of available channels is shown.
In this tutorial we select the channel with address "pv_energy_production".
Click "add channels".</p>
</div>
<div class="paragraph">
<p>Now the channel overview opens where we can find our selected channel.
In the last step of the configuration we click on the edit icon of the channel and set the parameters <em>logging interval</em> and <em>sampling interval</em> to 5000 ms and change the unit to kWh.</p>
</div>
<div class="paragraph">
<p>You can now check that the new channel was added to the "conf/channels.xml" file.</p>
</div>
<div class="paragraph">
<p>After submitting the channel configuration we go back to the dashboard and open the Channel Access Tool.
Here we select our home1 device and continue with <em>access selected</em>.
Now we able to see the current values of the pv_energy_production channel.</p>
</div>
<div class="paragraph">
<p>The logged data can be found in <em>openmuc/framework/data/ascii/&lt;currentdate&gt;_5000.dat</em></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorials">3. Tutorials</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_build_a_simple_m_bus_data_logger">3.1. Build a Simple M-Bus Data Logger</h3>
<div class="paragraph">
<p><strong>Objective:</strong> You will learn how to create a simple data logger which reads out a M-Bus meter via serial communication. It uses OpenMUC on-board tools so no programming is required.</p>
</div>
<div class="paragraph">
<p><strong>Preparation:</strong> If not already done, your system needs to be prepared once for serial communication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo apt-get install librxtx-java
sudo adduser $USER dialout</pre>
</div>
</div>
<div class="paragraph">
<p>Now logout from your system and login again to apply system changes.</p>
</div>
<div class="paragraph">
<p><strong>Step-by-step</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download OpenMUC and unpack it</p>
</li>
<li>
<p>Open openmuc/framework/conf/bundles.conf.gradle and comment the following lines by //</p>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.openmuc.framework", name: "openmuc-app-simpledemo", version: openmucVersion
osgibundles group: "org.openmuc.framework", name: "openmuc-driver-csv", version: openmucVersion</pre>
</div>
</div>
</li>
<li>
<p>Add following lines to make the M-Bus driver and serial communication available</p>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.openmuc.framework", name: "openmuc-driver-mbus", version: openmucVersion
osgibundles group: "org.openmuc", name: "jrxtx", version: "1.0.1"</pre>
</div>
</div>
</li>
<li>
<p>To apply changes navigate to openmuc/framework/bin and run</p>
<div class="listingblock">
<div class="content">
<pre>./openmuc update-bundles</pre>
</div>
</div>
</li>
<li>
<p>Start OpenMUC</p>
<div class="listingblock">
<div class="content">
<pre>./openmuc start -fg</pre>
</div>
</div>
</li>
<li>
<p>Open a browser and point it to localhost:8888 to view the WebUI of OpenMUC. Login with user <em>admin</em> and password <em>admin</em>.</p>
</li>
<li>
<p>Click on <em>Channel Configurator</em> &gt; <em>Tab Drivers</em> &gt; <em>Add new driver to configuration</em></p>
</li>
<li>
<p>Enter <em>mbus</em> as ID and click Submit</p>
</li>
<li>
<p>Now the M-Bus driver appears under <em>Channel Configurator</em> &gt; <em>Tab Drivers</em>. Click on the search icon</p>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_mbus_logger_channel_configurator.png"><img src="./images/tutorial_mbus_logger_channel_configurator.png" alt="tutorial mbus logger channel configurator" width="400"></a>
</div>
<div class="title">Figure 7. WebUI data plotter</div>
</div>
</li>
<li>
<p>Enter the serial port the meter is connected to and provide the baud rate if needed (e.g. /dev/ttyS0 or /dev/ttyS0:2400). See M-Bus driver section
for more information. If you are using an USB device you can use the <em>dmesg</em> tool on linux to figure out on what port it is connected (e.g. /dev/ttyUSB0).</p>
</li>
<li>
<p>Click on <em>Scan for devices</em>. Now OpenMUC scans all M-Bus addresses, which may take a while</p>
</li>
<li>
<p>Select the desired device from the list and click <em>Add devices</em></p>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_mbus_logger_driver_scan.png"><img src="./images/tutorial_mbus_logger_driver_scan.png" alt="tutorial mbus logger driver scan" width="400"></a>
</div>
<div class="title">Figure 8. WebUI M-Bus device scan</div>
</div>
</li>
<li>
<p>Now the device is added. If you do not see the search icon next to the device, press F5 to reload the page and navigate to <em>Channel Configurator</em> &gt; <em>Tab Devices</em></p>
</li>
<li>
<p>Click on the search icon and OpenMUC automatically scans all available channels. Select the desired channels and click <em>Add channels</em></p>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_mbus_logger_channel_scan.png"><img src="./images/tutorial_mbus_logger_channel_scan.png" alt="tutorial mbus logger channel scan" width="400"></a>
</div>
<div class="title">Figure 9. WebUI M-Bus channel scan</div>
</div>
</li>
<li>
<p>Now we need to define a sampling and logging interval for the channels. Click on <em>Channel Configurator</em> &gt; <em>Tab Channels</em> and click on <em>Edit Icon</em> of
the desired channel. Write <em>2000</em> in the <em>Sampling Interval</em> and <em>Logging Interval</em> field and click Submit</p>
</li>
<li>
<p>To show actual values of the channel, navigate to <em>Applications</em> &gt; <em>Channel Access Tool</em>, select your device and click <em>Access selected</em></p>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_mbus_logger_channel_access_tool.png"><img src="./images/tutorial_mbus_logger_channel_access_tool.png" alt="tutorial mbus logger channel access tool" width="400"></a>
</div>
<div class="title">Figure 10. WebUI channel access tool</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Tips</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>All logged data are stored in /openmuc/framework/data/ascii/</p>
</li>
<li>
<p>You can also change the configuration by editing /openmuc/framework/conf/channels.xml</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_develop_a_customised_application">3.2. Develop a Customised Application</h3>
<div class="paragraph">
<p><strong>Objective:</strong> You will learn how to develop your own OpenMUC application. This tutorial focuses on the Eclipse integration, build process and how to start
your application in the felix OSGi framework.</p>
</div>
<div class="paragraph">
<p><strong>Preparation:</strong> This tutorial is based on Eclipse IDE and Gradle build tool, therefore you need Eclipse IDE and Gradle installed on your pc.</p>
</div>
<div class="paragraph">
<p><strong>Step-by-step</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and unpack the OpenMUC framework. Open a terminal and navigate to the openmuc folder</p>
</li>
<li>
<p>Create a new project based on the simple demo application. Navigate to openmuc/projects/app and copy the simpledemo folder and rename the copy to <em>ems</em> (Energy Management System).</p>
</li>
<li>
<p>Edit the build.gradle file inside your <em>ems</em> folder. Rename the project name and description and save the file.</p>
<div class="listingblock">
<div class="content">
<pre>def projectName = "EMS"
...
description "OpenMUC Energy Management System."</pre>
</div>
</div>
</li>
<li>
<p>Navigate to app/ems/src/main/java/org/openmuc/framework/app/ and rename the folder simpledemo to ems</p>
</li>
<li>
<p>Replace the SimpleDemoApp.java inside this ems folder with EmsApp.java.</p>
<div class="listingblock">
<div class="content">
<pre>package org.openmuc.framework.app.ems;

import org.openmuc.framework.data.Record;
import org.openmuc.framework.dataaccess.Channel;
import org.openmuc.framework.dataaccess.DataAccessService;
import org.openmuc.framework.dataaccess.RecordListener;
import org.osgi.service.component.annotations.Activate;
import org.osgi.service.component.annotations.Component;
import org.osgi.service.component.annotations.Deactivate;
import org.osgi.service.component.annotations.Reference;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

@Component(service = {})
public final class EmsApp{

	private static final Logger logger = LoggerFactory.getLogger(EmsApp.class);
	private static final String APP_NAME = "OpenMUC EMS App";

	private Channel chPowerGrid;
	private RecordListener powerListener;

	@Reference
	private DataAccessService dataAccessService;

	@Activate
	private void activate() {
		logger.info("Activating {}", APP_NAME);
		powerListener = new PowerListener();
		chPowerGrid = dataAccessService.getChannel("power_grid");
		chPowerGrid.addListener(powerListener);
	}

	@Deactivate
	private void deactivate() {
		logger.info("Deactivating {}", APP_NAME);
		chPowerGrid.removeListener(powerListener);
	}
}

class PowerListener implements RecordListener{

	private static final Logger logger = LoggerFactory.getLogger(PowerListener.class);

	@Override
	public void newRecord(Record record) {
		if (record.getValue() != null) {
			logger.info("&gt;&gt;&gt; grid power: {}", record.getValue().asDouble());
		}
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>This is a light version of the simple demo application and basically adds a listener to the power_grid channel and logs the current value. This class
can be used for further development of your application.</p>
</div>
</li>
<li>
<p>Now we add our project to the gradle build process. For this purpose open the openmuc/settings.gradle in an editor and append following statement
to the include statement</p>
<div class="listingblock">
<div class="content">
<pre>, "openmuc-app-ems"</pre>
</div>
</div>
</li>
<li>
<p>Furthermore you need to add following line at the end of settings.gradle</p>
<div class="listingblock">
<div class="content">
<pre>project(":openmuc-app-ems").projectDir = file("projects/app/ems")</pre>
</div>
</div>
</li>
<li>
<p>Now we create the Eclipse project files by running the following command in the openmuc main directory</p>
<div class="listingblock">
<div class="content">
<pre>gradle eclipse</pre>
</div>
</div>
</li>
<li>
<p>Start your Eclipse IDE and set the GRADLE_USER_HOME classpath variable: Go to Window&gt;Preferences&gt;Java&gt;Build Path&gt;Classpath Variable. Set the
variable GRADLE_USER_HOME to the path of the ~/.gradle folder in your home directory (e.g. /home/&lt;user_name&gt;/.gradle/</p>
</li>
<li>
<p>Import the Openmuc projects into Eclipse: Go to File&gt;Import&gt;General&gt;Existing Projects into Workspace, select your OpenMUC directory and click on
Finish. All projects should be imported without any errors.</p>
</li>
<li>
<p>Now add the EMS application to the OpenMUC Framework. Navigate openmuc/framework/conf and and following line to bundles.conf.gradle below the openmuc-app-simpledemo entry:</p>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.openmuc.framework", name: "openmuc-app-ems",                   version: openmucVersion</pre>
</div>
</div>
</li>
<li>
<p>Finally we build the framework and start our application. Navigate to openmuc/framework/bin and run:</p>
<div class="listingblock">
<div class="content">
<pre>./openmuc update-bundles -b</pre>
</div>
</div>
<div class="paragraph">
<p>This will build all bundles and copies them to /openmuc/framework/bundles. Our EMS app should be now inside this folder e.g. openmuc-app-ems-&lt;version&gt;.jar</p>
</div>
</li>
<li>
<p>Start the framework with:</p>
<div class="listingblock">
<div class="content">
<pre>./openmuc start -fg</pre>
</div>
</div>
</li>
<li>
<p>The log messages of our EMS application are now visible in the terminal e.g:</p>
<div class="listingblock">
<div class="content">
<pre>2018-12-17 19:10:20.015 [...] INFO  o.o.framework.app.simpledemo.EmsApp - &gt;&gt;&gt; grid power: -1.779
2018-12-17 19:10:25.006 [...] INFO  o.o.framework.app.simpledemo.EmsApp - &gt;&gt;&gt; grid power: -1.761</pre>
</div>
</div>
</li>
<li>
<p>Now you know all the steps to build a new application and get it running in OpenMUC. For further development you should have a look at the source code of the SimpleDemoApp.java.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="anchor-tutorial-webui-plugin">3.3. Develop a Customised WebUI Plugin</h3>
<div class="paragraph">
<p><strong>Objective:</strong> In this tutorial you will learn how to add a plugin to the WebUI as well as how to display data from your configured channels. Examples
for such plugins are the <em>simpledemovisualisation</em> bundle or the
<a href="https://www.openmuc.org/projects/heiphoss/">HeiPhoss WebUI</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>This tutorial describes how we developed the simpledemovisualisation. When creating your own plugin you can just replace the
name <em>simpledemovisualisation</em> whenever it comes up in the tutorial.</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Preparation:</strong> You should be familiar with OpenMUC&#8217;s <a href="#anchor-architecture">architecture</a>.</p>
</div>
<div class="paragraph">
<p><strong>Step-by-step</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First we have to create a new Project with the Structure</p>
<div class="listingblock">
<div class="content">
<pre>openmuc/projects/webui/simpledemovisualisation</pre>
</div>
</div>
</li>
<li>
<p>Now copy the build.gradle file from one of the existing WebUI plugins, for example:</p>
<div class="listingblock">
<div class="content">
<pre>openmuc/projects/webui/channelaccesstool/build.gradle</pre>
</div>
</div>
<div class="paragraph">
<p>into this project and change the projectName and projectDescription</p>
</div>
<div class="listingblock">
<div class="content">
<pre>def projectName = "OpenMUC WebUI - Simple Demo Visualisation"
def projectDescription = "Simple Demo Visualisation plug-in for the WebUI of the OpenMUC framework."</pre>
</div>
</div>
</li>
<li>
<p>Open openmuc/configuration.gradle and add the following line under distributionProjects = javaProjects.findAll</p>
<div class="listingblock">
<div class="content">
<pre>it.getPath() == ":openmuc-webui-simpledemovisualisation" ||</pre>
</div>
</div>
</li>
<li>
<p>Open openmuc/settings.gradle and add the following line under OpenMUC WebUI Bundles of the include section</p>
<div class="listingblock">
<div class="content">
<pre>'openmuc-webui-simpledemovisualisation',</pre>
</div>
</div>
</li>
<li>
<p>Furthermore, add the following line to the projects section of the settings.gradle</p>
<div class="listingblock">
<div class="content">
<pre>project(":openmuc-webui-simpledemovisualisation").projectDir = file('projects/webui/simpledemovisualisation')</pre>
</div>
</div>
</li>
<li>
<p>Open openmuc/framework/conf/bundles.conf.gradle and add the following line under dependencies</p>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.openmuc.framework", name: "openmuc-webui-simpledemovisualisation", version: openmucVersion</pre>
</div>
</div>
<div class="paragraph">
<p>Next we will take a look at how our project should be structured once we are done</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/simpleDemoVisualisationTree.png"><img src="./images/simpleDemoVisualisationTree.png" alt="simpleDemoVisualisationTree" width="960"></a>
</div>
</div>
</li>
<li>
<p>First we will take a look at the java file. Recreate the folder structure above and create the java file SimpleDemoVisualisation.java, and then copy this into it</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.openmuc.framework.webui.spi.WebUiPluginService</span>;
<span class="keyword">import</span> <span class="include">org.osgi.service.component.annotations.Component</span>;

<span class="annotation">@Component</span>(service = WebUiPluginService.class)
<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">SimpleDemoVisualisation</span> <span class="directive">extends</span> WebUiPluginService {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getAlias() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">simpledemovisualisation</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Simple Demo Visualisation</span><span class="delimiter">&quot;</span></span>;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two functions getAlias and getName have to be overridden. The alias is used to identify the plugin while the name will be displayed in the WebUI. In
order to display an icon above the plugin&#8217;s name, the file needs to be called icon and put in the images folder.</p>
</div>
</li>
<li>
<p>Next we will take a look at app.js and app.routes.js. In app.js all we do is creating a module and naming it.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">(<span class="keyword">function</span>(){
        angular.module(<span class="string"><span class="delimiter">'</span><span class="content">openmuc.openmuc-visu</span><span class="delimiter">'</span></span>, []);
})();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The more interesting one is app.routes.js because it is responsible for allowing us to get from the main page to the page of our plugin. It also allows
us to specify which files have to be loaded.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">(<span class="keyword">function</span>(){

    <span class="keyword">var</span> app = angular.module(<span class="string"><span class="delimiter">'</span><span class="content">openmuc</span><span class="delimiter">'</span></span>);

    app.config([<span class="string"><span class="delimiter">'</span><span class="content">$stateProvider</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">$urlRouterProvider</span><span class="delimiter">'</span></span>,
        <span class="keyword">function</span>(<span class="predefined">$stateProvider</span>, <span class="predefined">$urlRouterProvider</span>) {
            <span class="predefined">$stateProvider</span>.
            state(<span class="string"><span class="delimiter">'</span><span class="content">simpledemovisualisation</span><span class="delimiter">'</span></span>, {
                <span class="key">url</span>: <span class="string"><span class="delimiter">'</span><span class="content">/simpledemovisualisation</span><span class="delimiter">'</span></span>,
                <span class="key">templateUrl</span>: <span class="string"><span class="delimiter">'</span><span class="content">simpledemovisualisation/html/index.html</span><span class="delimiter">'</span></span>,
                <span class="key">requireLogin</span>: <span class="predefined-constant">true</span>
            }).
            state(<span class="string"><span class="delimiter">'</span><span class="content">simpledemovisualisation.index</span><span class="delimiter">'</span></span>, {
                <span class="key">url</span>: <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>,
                <span class="key">templateUrl</span>: <span class="string"><span class="delimiter">'</span><span class="content">simpledemovisualisation/html/graphic.html</span><span class="delimiter">'</span></span>,
                <span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">VisualisationController</span><span class="delimiter">'</span></span>,
                <span class="key">requireLogin</span>: <span class="predefined-constant">true</span>,
                <span class="key">resolve</span>: {
                    <span class="function">openmuc</span>: <span class="keyword">function</span> (<span class="predefined">$ocLazyLoad</span>) {
                        <span class="keyword">return</span> <span class="predefined">$ocLazyLoad</span>.load(
                            {
                                <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">openmuc.simpledemovisualisation</span><span class="delimiter">'</span></span>,
                                <span class="key">files</span>: [<span class="string"><span class="delimiter">'</span><span class="content">openmuc/js/channels/channelsService.js</span><span class="delimiter">'</span></span>,
                                    <span class="string"><span class="delimiter">'</span><span class="content">openmuc/js/channels/channelDataService.js</span><span class="delimiter">'</span></span>,
                                    <span class="string"><span class="delimiter">'</span><span class="content">simpledemovisualisation/css/simpledemovisualisation/main.css</span><span class="delimiter">'</span></span>,
                                   <span class="string"><span class="delimiter">'</span><span class="content">simpledemovisualisation/js/visu/VisualisationController.js</span><span class="delimiter">'</span></span>]
                            }
                        )
                    }
                }
            })
        }]);

})();</code></pre>
</div>
</div>
<div class="paragraph">
<p>All files you need have to be added to the list "files" in order for the plugin to work. The first two files we load are necessary to access the defined channels. Then
we load in our css file and lastly the javascript file of this plugin.</p>
</div>
</li>
<li>
<p>For the Plugin created in this tutorial we will need an svg that is put into the image folder. The SimpleDemoGraphic.svg used in this tutorial is made up of multiple
images, paths as well as text fields. In this case only the text fields are of interest.</p>
</li>
<li>
<p>The two html files used in this app are very simple, index.html sets the headline and then calls on graphic.html through ui-view. Ui-view calls upon the route defined
in app.routes.js.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="HTML"><span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">page-header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h1&gt;</span>OpenMUC Visualisation<span class="tag">&lt;/h1&gt;</span>
<span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">ui-view</span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In graphic.html we create a div element and assign it the class svg-container. We then create an object HTML element inside the div and assign it the class svg-content.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="HTML"><span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">svg-container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;object</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleDemoGraphic</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">image/svg+xml</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">data</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpledemovisualisation/images/SimpleDemoGraphic.svg</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">svg-content</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">onload</span>=<span class="string"><span class="delimiter">&quot;</span>display_visualisation()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/object&gt;</span>
<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Further we also assign it an Id, in this case simpleDemoGraphic, specify that it is of the type svg and tell it where our svg is located. This way our svg is now displayed on the page, but in order to change elements of the svg we need a javascript function which is called through onload.</p>
</div>
</li>
<li>
<p>In order to specify how our page should be displayed we use a css file.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CSS"><span class="tag">html</span>, <span class="tag">body</span> {
    <span class="key">font-family</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Arial</span><span class="delimiter">&quot;</span></span>;
    <span class="key">margin</span>: <span class="float">0px</span>;
    <span class="key">padding</span>: <span class="float">0px</span>;
}

<span class="class">.svg-container</span> {
    <span class="key">display</span>: <span class="value">inline-block</span>;
    <span class="key">position</span>: <span class="value">relative</span>;
    <span class="key">width</span>: <span class="float">1108px</span>;
    <span class="key">height</span>: <span class="float">760px</span>;
    <span class="key">border</span>:<span class="float">1px</span> <span class="value">solid</span> <span class="value">black</span>;
}

<span class="class">.svg-content</span> {
    <span class="key">display</span>: <span class="value">block</span>;
    <span class="key">position</span>: <span class="value">absolute</span>;
    <span class="key">width</span>: <span class="float">1106px</span>;
    <span class="key">height</span>: <span class="float">740px</span>;
    <span class="key">top</span>: <span class="float">0</span>;
    <span class="key">left</span>: <span class="float">0</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this css file we tell the browser how the html elements should look and be positioned. If the declaration starts with a dot it signifies all elements with the
specified class being targeted, a hash would signify an element with that Id being targeted and nothing signifies all html elements of that type should be targeted.</p>
</div>
</li>
<li>
<p>By default the svg will have an eight pixel margin on each side, meaning there will be white space between the border and svg. If you dont want that you need to
open the svg in a text editor and add a style tag after the svg tag as shown below</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="HTML"><span class="tag">&lt;svg</span>
   <span class="attribute-name">xmlns:osb</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.openswatchbook.org/uri/2009/osb</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:dc</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://purl.org/dc/elements/1.1/</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:cc</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://creativecommons.org/ns#</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:rdf</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/02/22-rdf-syntax-ns#</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:svg</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2000/svg</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2000/svg</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:xlink</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xlink</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:sodipodi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:inkscape</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.inkscape.org/namespaces/inkscape</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">viewBox</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0 0 573.61664 357.1875</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.1</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">svg8</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">inkscape:version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0.92.3 (2405546, 2018-03-11)</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">sodipodi:docname</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SimpleDemoGraphic.svg</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;style</span>
     <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/css</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">media</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">screen</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">style5004</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="inline"><span class="error">&lt;</span><span class="error">!</span>[<span class="attribute-name">CDATA[
      body{
         margin: 0px;
      }
    </span>]<span class="error">]</span>&gt;</span><span class="tag">&lt;/style&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We cannot change the css of the svg from our css file so we have to do it inside the svg.</p>
</div>
</li>
<li>
<p>Finally we take a look at the javascript file that will allow us to display data in real time.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">(<span class="keyword">function</span>(){

    <span class="keyword">var</span> injectParams = [<span class="string"><span class="delimiter">'</span><span class="content">$scope</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">$interval</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ChannelsService</span><span class="delimiter">'</span></span>];

    <span class="keyword">var</span> <span class="function">VisualisationController</span> = <span class="keyword">function</span>(<span class="predefined">$scope</span>, <span class="predefined">$interval</span>, ChannelsService) {
        <span class="keyword">var</span> svg_document;

        <span class="function">display_visualisation</span> = <span class="keyword">function</span>() {</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we "import" the angular functions $scope and $interval as well as the class ChannelsService. Next we take a look at the function display_visualisation that
is called when the html page loads.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">svg_document = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">simpleDemoGraphic</span><span class="delimiter">'</span></span>).contentDocument;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Through this line of code we now have access to the svg in javascript. We achieve this by calling document.getElementById with the id of our object element as
a parameter. The contentDocument means that the return value is the document object, otherwise the return would have just been the content of the document, in
which case we could not use it in the way we need to later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">    <span class="predefined">$scope</span>.interval = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
    <span class="predefined">$interval</span>.cancel(<span class="predefined">$scope</span>.interval);
    <span class="predefined">$scope</span>.interval = <span class="predefined">$interval</span>(<span class="keyword">function</span>(){
        ...
    }, <span class="integer">500</span>);
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>What follows is defined inside this interval, meaning it will be repeated every 500 milliseconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">ChannelsService.getAllChannels().then(async <span class="keyword">function</span>(channels) {
                    <span class="predefined">$scope</span>.channels = await channels.records;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we call the function getAllChannels of the class ChannelsService. It makes a get call to the REST server and returns all the channels defined in the
channels.xml. The "then" means that whatever is in the round brackets will be executed after getAllChannels' return value arrives. Inside these round
brackets we define an async function with getAllChannels' return value as a parameter. The list records of the return value contains the requested channels,
so we save them in the list $scope.channels. Normally the rest of the code would be executed while getAllChannels waits for a reply, in which case our code
would fail as $scope.channels would be undefined, but the await keyword in conjunction with marking the function as async makes it so the code only resumes
executing once the await has been resolved.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">if</span> (<span class="predefined">$scope</span>.channels != <span class="predefined-constant">undefined</span>){
    <span class="predefined">$scope</span>.channels.forEach(<span class="keyword">function</span>(channel){
        <span class="keyword">if</span> (channel.id === <span class="string"><span class="delimiter">&quot;</span><span class="content">power_heatpump</span><span class="delimiter">&quot;</span></span>){
            textHeatPump = svg_document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">textHeatPump</span><span class="delimiter">&quot;</span></span>);
            textHeatPump.textContent = channel.record.value + <span class="string"><span class="delimiter">&quot;</span><span class="content"> kW</span><span class="delimiter">&quot;</span></span>;
        }
        <span class="keyword">if</span> (channel.id === <span class="string"><span class="delimiter">&quot;</span><span class="content">power_electric_vehicle</span><span class="delimiter">&quot;</span></span>){
            textChargingStation = svg_document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">textChargingStation</span><span class="delimiter">&quot;</span></span>);
            textChargingStation.textContent = channel.record.value + <span class="string"><span class="delimiter">&quot;</span><span class="content"> kW</span><span class="delimiter">&quot;</span></span>;
        }
        <span class="keyword">if</span> (channel.id === <span class="string"><span class="delimiter">&quot;</span><span class="content">power_photovoltaics</span><span class="delimiter">&quot;</span></span>){
            textPv = svg_document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">textPv</span><span class="delimiter">&quot;</span></span>);
            textPv.textContent = channel.record.value + <span class="string"><span class="delimiter">&quot;</span><span class="content"> kW</span><span class="delimiter">&quot;</span></span>;
        }
        <span class="keyword">if</span> (channel.id === <span class="string"><span class="delimiter">&quot;</span><span class="content">power_grid</span><span class="delimiter">&quot;</span></span>){
            textGrid = svg_document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">textGrid</span><span class="delimiter">&quot;</span></span>);
            textGrid.textContent = channel.record.value + <span class="string"><span class="delimiter">&quot;</span><span class="content"> kW</span><span class="delimiter">&quot;</span></span>;
        }
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First we check if our list is not undefined as it is possible that during the first interval there wont be any data to work with. Now we iterate through our
channels list to find the channels we need. Once we found the right channel, we search for the corresponding text field and save the reference to it in a
variable. By setting the textContent of the text field we can change what is displayed, in this case the channel&#8217;s value is displayed in the text field. Now
we set the interval and close the function definition as shown above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">        <span class="predefined">$scope</span>.<span class="predefined">$on</span>(<span class="string"><span class="delimiter">'</span><span class="content">$destroy</span><span class="delimiter">'</span></span>, <span class="keyword">function</span> () {
            <span class="predefined">$interval</span>.cancel(<span class="predefined">$scope</span>.interval);
        });

        };

    VisualisationController.<span class="predefined">$inject</span> = injectParams;

    angular.module(<span class="string"><span class="delimiter">'</span><span class="content">openmuc.openmuc-visu</span><span class="delimiter">'</span></span>).controller(<span class="string"><span class="delimiter">'</span><span class="content">VisualisationController</span><span class="delimiter">'</span></span>, VisualisationController);

})();</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that we tell the function to stop the interval if the scope&#8217;s destroy event is triggered and that the in app.js defined module should use this controller.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Tips</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you want to change the css of the svg at runtime you can do so through javascript similarly to the manipulation of the text field above.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">textHeatPump.style.fill = <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would set the text color of the text field to blue</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="anchor-architecture">4. Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following image depicts the software layers of an OpenMUC system.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/openmuc-software-layers.png"><img src="./images/openmuc-software-layers.png" alt="openmuc software layers" width="60%"></a>
</div>
<div class="title">Figure 11. OpenMUC software layers</div>
</div>
<div class="paragraph">
<p>The OpenMUC framework runs within an OSGi environment which in turn is being run by a Java Virtual Machine.
The underlying operating system and hardware can be chosen freely as long as it can run a Java 8 VM.</p>
</div>
<div class="paragraph">
<p>OpenMUC consists essentially of various software modules which are implemented as OSGi bundles that run in the OSGi environment and communicate over OSGi services.
The following figure illustrates the main modules that make up OpenMUC.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/openmuc-bundles-with-numbers.png"><img src="./images/openmuc-bundles-with-numbers.png" alt="openmuc bundles with numbers" width="60%"></a>
</div>
<div class="title">Figure 12. OpenMUC modules</div>
</div>
<div class="paragraph">
<p>All modules except for the data manager are optional.
Thus by selecting the modules you need you can easily create your own customized and lightweight system.</p>
</div>
<div class="paragraph">
<p>The different modules in the picture are now further explained:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <strong>data manager</strong> represents the core and center of OpenMUC.
Virtually all other OpenMUC modules (e.g. drivers, data loggers, servers, applications and web interface plugins) communicate with it through OSGi services.
The data manager gets automatically notified when new drivers or data loggers get installed.
OpenMUC applications communicate with devices, access logged data or change the configuration by calling service functions provided by the data manager.
It is therefore the data manager that shields the application programmer from the details of the communication and data logging technology.
What the data manager does is mostly controlled through a central configuration.</p>
</li>
<li>
<p>The <strong>channel configuration</strong> holds the user defined data channels and its parameters.
Data channels are the frameworks representation of data points in connected devices.
Amongst others the channel configuration holds the following information:</p>
<div class="openblock">
<div class="content">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>communication parameters that the drivers require</p>
</li>
<li>
<p>when to sample new data from connected devices</p>
</li>
<li>
<p>when to send sampled data to existing data logger(s) for efficient persistent storage.
The configuration is stored in the file conf/channels.xml.
You may add or modify the configured channels by manually editing the channels.xml file or through the channel configurator web interface.</p>
</li>
</ol>
</div>
</div>
</div>
</li>
<li>
<p>A <strong>driver</strong> is used by the data manager to send/get data to/from a connected device.
Thus a driver usually implements a communication protocol.
Several communication drivers have already been developed (e.g. IEC 61850, ModbusTCP, KNX, DLMS/COSEM).
Many drivers use standalone communication libraries (e.g. OpenIEC61850, jMBus) developed by the OpenMUC team.
These libraries do not depend on the OpenMUC framework and can therefore be used by any Java application.
New communication drivers for OpenMUC can be easily developed by third parties.</p>
</li>
<li>
<p>A <strong>data logger</strong> saves sampled data persistently.
The data manager forwards sampled data to all available data loggers if configured to do so.
Data loggers are specifically designed to store time series data for short storage and retrieval times.
OpenMUC currently includes four data loggers.
The ASCII data logger saves data in a human readable text format while SlotsDB saves data in a more efficient binary format.
And two loggers for remote system logging with AMQP or MQTT.</p>
</li>
<li>
<p>If all you want is sample and log data then you can use the OpenMUC framework as it is and simply configure it to your needs.
But if you want to process sampled data or control a device you will want to write your own <strong>application</strong>.
Like all other modules your application will be an OSGi bundle.
In your application you can use the DataAccessService and the ConfigService provided by the data manager to access sampled and logged data.
You may also issue immediate read or write commands.
These are forwarded by the data manager to the driver.
The configuration (when to sample and to log) can also be changed during run-time by the application.
At all times the application only communicates with the data manager and is therefore not confronted with the complicated details of the communication technology being used.</p>
</li>
<li>
<p>If your application is located on a remote system (e.g. a smart phone or an Internet server) then the data and configuration can be accessed through an OpenMUC <strong>server</strong>.
At the moment OpenMUC provides a RESTful web service for this purpose.</p>
</li>
<li>
<p>The OpenMUC framework provides a web user interface (<strong>WebUI</strong>) for tasks such as configuration, visualization of sampled data or exporting logged data.
The web interface is modular and provides a plug-in interface.
This way developers may write a website that integrates into the main menu of the web interface.
The WebUI is mostly for configuration and testing purposes.
Most companies will want to create their own individual UI.</p>
</li>
<li>
<p>OpenMUC also contains a set of core <strong><a href="#anchor-libraries">libraries</a></strong> which provide helper classes that are used by multiple bundles of the framework.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_file_structure_of_the_distribution">4.1. File Structure of the Distribution</h3>
<div class="paragraph">
<p>The distribution contains the following important files and folders:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">build/libs-all</dt>
<dd>
<p>All modules/bundles that make up the OpenMUC framework</p>
</dd>
<dt class="hdlist1">dependencies</dt>
<dd>
<p>Information on the external dependencies of the OpenMUC
framework. Also contains the RXTX library (repacked as a bundle)
which is needed by many OpenMUC drivers based on serial
communication.</p>
</dd>
<dt class="hdlist1">projects</dt>
<dd>
<p>All sources of the OpenMUC framework. You can easily change and
rebuild OpenMUC using Gradle.</p>
</dd>
<dt class="hdlist1">framework</dt>
<dd>
<p>A ready to use OpenMUC demo framework that is introduced next.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_folder_framework">4.2. Folder framework/</h3>
<div class="paragraph">
<p>The folder "framework" contains a configured OpenMUC framework that can be used as a basis to create your own customized OpenMUC framework for your task.
The framework folder contains the following important files and folders:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">felix</dt>
<dd>
<p>The main Apache Felix OSGi jar which is run to start OpenMUC.</p>
</dd>
<dt class="hdlist1">bin</dt>
<dd>
<p>Run scripts for Linux/Unix and Windows.</p>
</dd>
<dt class="hdlist1">bundle</dt>
<dd>
<p>Contains all bundles that are started by the Felix OSGi
framework. Note that this folder does not contain all available
OpenMUC bundles but only a subset for demonstration purposes.</p>
</dd>
<dt class="hdlist1">log</dt>
<dd>
<p>Log files produced by the running framework.</p>
</dd>
<dt class="hdlist1">conf</dt>
<dd>
<p>Various configuration files of the framework.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_folder_conf">4.2.1. Folder conf/</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">bundles.conf.gradle</dt>
<dd>
<p>Contains a list of all bundles which should be used for the framework.</p>
</dd>
<dt class="hdlist1">channels.xml</dt>
<dd>
<p>Configuration file of OpenMUC to configure drivers, devices and channels.</p>
</dd>
<dt class="hdlist1">config.properties</dt>
<dd>
<p>Property file of the Felix OSGi framework.</p>
</dd>
<dt class="hdlist1">logback.xml</dt>
<dd>
<p>Configuration file to configure log levels for console and log file.</p>
<div class="literalblock">
<div class="content">
<pre>Currently, the logging is configured to create logfiles of at most 100MB, create a new log file every day and keep a maximum of 30 days or 3GB, which ever is reached first.</pre>
</div>
</div>
</dd>
<dt class="hdlist1">system.properties</dt>
<dd>
<p>Contains general settings for the OpenMUC framework</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_devices_and_channels">4.3. Devices and Channels</h3>
<div class="paragraph">
<p>OpenMUC works on the basis of channels.
A channel basically represents a single data point.
Some examples for a channel are the metered active power of a smart meter, the temperature of a temperature sensor, any value of digital or analog I/O module or the some manufacture data of the device.
Thus a channel can represent any kind of data point.
The following picture illustrates the channel concept.</p>
</div>
<div class="paragraph">
<div class="title">OpenMUCs Channel Concept</div>
<p><span class="image"><a class="image" href="images/openmuc_concept.png"><img src="./images/openmuc_concept.png" alt="OpenMUC channel concept" width="60%"></a></span></p>
</div>
</div>
<div class="sect2">
<h3 id="anchor-configuration">4.4. Configuration via channels.xml</h3>
<div class="paragraph">
<p>The <strong>conf/channels.xml</strong> file is the main configuration file for OpenMUC.
It tells the OpenMUC framework which channels it should log and sample.
It contains a hierarchical structure of drivers, devices and channels.
A driver can have one or more devices and devices can have one or more channels.
Following listing shows a sample configuration to illustrate the hierarchical structure.
The driver, device and channel options are explained afterwards.</p>
</div>
<div class="listingblock">
<div class="title">channels.xml structure</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>
<span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;logger&gt;</span>loggerId<span class="tag">&lt;/logger&gt;</span>

        <span class="tag">&lt;driver</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">driver_x</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="comment">&lt;!-- driver options --&gt;</span>
                <span class="tag">&lt;device&gt;</span>
                        <span class="comment">&lt;!-- device options --&gt;</span>
                        <span class="tag">&lt;channel&gt;</span>
                                <span class="comment">&lt;!-- channel options --&gt;</span>
                        <span class="tag">&lt;/channel&gt;</span>
                        <span class="tag">&lt;channel&gt;</span>
                                <span class="comment">&lt;!-- channel options --&gt;</span>
                        <span class="tag">&lt;/channel&gt;</span>
                <span class="tag">&lt;/device&gt;</span>
        <span class="tag">&lt;/driver&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. <strong>Driver options</strong></caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id of the driver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">samplingTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default time waited for a read operation to complete if the device doesn&#8217;t set a samplingTimeout on its own.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectRetryInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default time waited until a failed connection attempt is repeated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">While disabled, no connections to devices on this driver are established at all and all channels of these devices stop being sampled and logged.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. <strong>Device options</strong></caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the device.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deviceAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address for the driver to uniquely identify the device.
Syntax of this address is up to the driver implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description of the device.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional settings for the driver.
Syntax is up to the driver implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">samplingTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time waited for a read operation to complete.
Overwrites samplingTimeout of Driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectRetryInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time waited until a failed connection attempt is repeated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">While disabled, no connection of this device is established and all channels of this device stop being sampled and logged.</p></td>
</tr>
</tbody>
</table>
<table id="anchor-channel-options" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. <strong>Channel options</strong></caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Globally unique identifier.
Used by data logger implementations.
The OpenMUC framework automatically generates an id if none is provided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description of the channel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">channelAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The channelAddress is driver specific and contains the necessary parameters for the driver to access.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional settings for the driver.
Syntax is up to the driver implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>DOUBLE<br>
FLOAT<br>
LONG<br>
INTEGER<br>
SHORT<br>
BYTE<br>
BOOLEAN<br>
BYTE_ARRAY<br>
STRING</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOUBLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data type of the channel.
Used on data logger.
Driver implementation do NOT receive this settings!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueType Attribute: <em>length</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The attribute <em>length</em> is only used if valueType is BYTE_ARRAY or STRING.
Determines the maximum length of the byte array or string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scalingFactor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>double</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is used to scale a value read by a driver or set by an application.
The value read by an driver is multiplied with the scalingFactor and a value set by an application is divided by the scalingFactor.
Possible values are e.g.: 1.0 4.94147E-9 -2.4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueOffset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>double</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is used to offset a value read by a driver or set by an application.
The offset is added to a value read by a driver and subtracted from a value set by an application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical unit of this channel.
For information only (info can be accessed by an app or driver)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time difference until this channel is logged again. Omitting loggingInterval disables logging in intervals. Setting loggingInterval disables loggingEvent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingTimeOffset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, immediately logs latest record on value change.
Only supported by some data loggers. Disabled if loggingInterval is set.
See <a href="#anchor-dataloggers">data logger description</a> for more information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingSettings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data logger specific log settings.
Format: &lt;loggerId_A&gt;[:&lt;param_A&gt;=&lt;value_A&gt;][,][;&lt;loggerId_B&gt;[:&lt;param_B&gt;=&lt;value_B&gt;]].
See <a href="#anchor-dataloggers">data logger description</a> for more information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingSettings Attribute: <em>reader</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In case multiple readers are registered in the framework you can use the attribute <em>reader</em> to specify a dedicated logger for reading values e.g. &lt;loggingSettings reader="asciilogger"&gt;mqttlogger:topic=my/topic&lt;/loggingSettings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listening</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines if this channel shall passively listen for incoming value changes from the driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">samplingInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time interval between two attempts to read this channel. -1 or omitting samlingOffset disables sampling on this channel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">samplingTimeOffset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">samplingGroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For grouping channels.
All channels with the same samplingGroup and same samplingInterval are in one group.
The purpous of samplingGroups is to improve the drivers performance - if possible.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a channel is disabled, all sampling and logging actions of this channel are stopped.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>*time: integer with suffix (ms, s, m, h) like: 300ms, 2s.</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>if you don&#8217;t use a suffix, then ms is automatically used</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The available driver settings, device settings and channel settings can also be found in the
<a href="https://www.openmuc.org/openmuc/javadoc/">Javadoc</a> of DriverConfig.java, DeviceConfig.java and ChannelConfig.java respectively.</p>
</div>
<div class="paragraph">
<p><strong>Default Data Logger</strong></p>
</div>
<div class="paragraph">
<p>You can define a default data logger by adding a logger element with the id of a data logger to the configuration.
If available, that data logger is used to read logged values.
The ids of data loggers shipped with the OpenMUC Framework are defined in the "Data Loggers" chapter.
If no logger with the defined id is available, or the logger element is missing from the configuration, an arbitrary available logger is used to read logged values.
Only one default logger may be defined.
If multiple logger elements exists, only the first one is evaluated.</p>
</div>
<div class="paragraph">
<p>This configuration only affects reading of already logged values.
Channels are still logged by all available loggers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sampling_listening_and_logging">4.5. Sampling, Listening and Logging</h3>
<div class="ulist">
<ul>
<li>
<p><strong>sampling</strong> is when the data manager frequently asks a driver to retrieve a channel value.</p>
</li>
<li>
<p><strong>listening</strong> is when the driver listens on a channel and forwards new values to the data manager.</p>
</li>
<li>
<p><strong>logging</strong> is when the data manager forwards the current sampled value to the data loggers that are installed.
The data loggers then store the data persistently</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following examples will give you a better understanding of these three settings.</p>
</div>
<div class="listingblock">
<div class="title">Example 1: Just Sampling</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channel&gt;</span>
    <span class="tag">&lt;id&gt;</span>channel1<span class="tag">&lt;/id&gt;</span>
    <span class="tag">&lt;channelAddress&gt;</span>dummy/channel/address/1<span class="tag">&lt;/channelAddress&gt;</span>
    <span class="tag">&lt;samplingInterval&gt;</span>4s<span class="tag">&lt;/samplingInterval&gt;</span>
<span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In example 1 the channel is sampled every 4 seconds which means the data manager requests every 4 seconds the current value from the driver.</p>
</div>
<div class="listingblock">
<div class="title">Example 2: Sampling and Logging</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channel&gt;</span>
    <span class="tag">&lt;id&gt;</span>channel2<span class="tag">&lt;/id&gt;</span>
    <span class="tag">&lt;channelAddress&gt;</span>dummy/channel/address/2<span class="tag">&lt;/channelAddress&gt;</span>
    <span class="tag">&lt;samplingInterval&gt;</span>4s<span class="tag">&lt;/samplingInterval&gt;</span>
    <span class="tag">&lt;loggingInterval&gt;</span>8s<span class="tag">&lt;/loggingInterval&gt;</span>
<span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 2 extends example 1 by an additional logging.
The logging interval is set to 8 seconds which means that every 8 seconds the last sampled value is stored in the database.
In this case every second sampled value is stored because the sampling interval is 4 seconds.
To log every sampled value the sampling interval and logging interval need to be the same.</p>
</div>
<div class="listingblock">
<div class="title">Example 3: Just Listening</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channel&gt;</span>
    <span class="tag">&lt;id&gt;</span>channel3<span class="tag">&lt;/id&gt;</span>
    <span class="tag">&lt;channelAddress&gt;</span>dummy/channel/address/3<span class="tag">&lt;/channelAddress&gt;</span>
    <span class="tag">&lt;listening&gt;</span>true<span class="tag">&lt;/listening&gt;</span>
<span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In example 3 listening instead of sampling is used.
This means that the driver reports a new channel value to the data manager when the value has changed for example.</p>
</div>
<div class="listingblock">
<div class="title">Example 4: Listening and Logging</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;channel&gt;</span>
    <span class="tag">&lt;id&gt;</span>channel4<span class="tag">&lt;/id&gt;</span>
    <span class="tag">&lt;channelAddress&gt;</span>dummy/channel/address/4<span class="tag">&lt;/channelAddress&gt;</span>
    <span class="tag">&lt;listening&gt;</span>true<span class="tag">&lt;/listening&gt;</span>
    <span class="tag">&lt;loggingInterval&gt;</span>8s<span class="tag">&lt;/loggingInterval&gt;</span>
<span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 4 extends example 3 by an additional logging.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When listening is true and additional a sampling interval is defined then the sampling is ignored.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example 5: Listening and Event-Logging</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;channel&gt;</span>
    <span class="tag">&lt;id&gt;</span>channel4<span class="tag">&lt;/id&gt;</span>
    <span class="tag">&lt;channelAddress&gt;</span>dummy/channel/address/5<span class="tag">&lt;/channelAddress&gt;</span>
    <span class="tag">&lt;listening&gt;</span>true<span class="tag">&lt;/listening&gt;</span>
    <span class="tag">&lt;loggingEvent&gt;</span>true<span class="tag">&lt;/loggingEvent&gt;</span>
<span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 5 extends example 3 by an additional event logging.
It loggs only if only a new value was received. (the logger needs to support event logging)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="anchor-start-script">5. OpenMUC Start Script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The script to start OpenMUC is located in <code>/framework/bin/</code>.</p>
</div>
<div class="sect2">
<h3 id="_start_openmuc">5.1. Start OpenMUC</h3>
<div class="paragraph">
<p>To start OpenMUC on Linux run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc start -fg</pre>
</div>
</div>
<div class="paragraph">
<p>This runs OpenMUC in the foreground on your console.
If you like to start OpenMUC as background process then skip the parameter <code><code>-fg</code></code>. On Windows you can run the <code><code>bin\openmuc.bat</code></code> to start OpenMUC. For now we will
focus on the Linux script, since Linux is the more common environment for OpenMUC. The <em>start</em> command
will basically run the Felix OSGi Framework via <code><code>java -jar felix/felix.jar</code></code> and Felix starts all bundles located in <em>framework/bundle</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stop_openmuc">5.2. Stop OpenMUC</h3>
<div class="paragraph">
<p>To stop OpenMUC run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc stop</pre>
</div>
</div>
<div class="paragraph">
<p>If you started OpenMUC in the foreground you can press ctrl+d or enter "stop 0" to stop OpenMUC.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restart_openmuc">5.3. Restart OpenMUC</h3>
<div class="paragraph">
<p>With the restart command OpenMUC stops and starts again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc restart</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reload_openmuc_configuration">5.4. Reload OpenMUC Configuration</h3>
<div class="paragraph">
<p>To reload the configuration without restarting OpenMUC use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc reload</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_update_bundles">5.5. Update Bundles</h3>
<div class="paragraph">
<p>If you have modified the bundles.conf.gradle file then run the following command to update the <code>/framework/bundle</code> folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc update-bundles</pre>
</div>
</div>
<div class="paragraph">
<p>If you have changed the source code and want to rebuild the bundles and apply them to the <code>/framework/bundle</code>
folder use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc update-bundles -b</pre>
</div>
</div>
<div class="paragraph">
<p>If you are using a local maven repository you can use the <code>-i</code> option to update the repository with the latest changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc update-bundles -i</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Tip:</strong> development the following command is quite handy to start OpenMUC with your latest code changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc update-bundles -b &amp;&amp; ./bin/openmuc start -fg</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_remote_shell">5.6. Remote Shell</h3>
<div class="paragraph">
<p>The remote shell allows you to connect via telnet to a running OpenMUC which was started as background process.</p>
</div>
<div class="paragraph">
<p>OpenMUC uses the Apache Felix Gogo JLine Shell by default, since JLine provides more advanced features than the standard GoGo Shell.
Unfortunately, JLine does not work in combination with the remote shell.
Therefore, we must switch back to the standard GoGo Shell to use remote access.
This can be achieved by modifying the <code>bundles.conf.gradle</code>.
Add the following bundles <code>org.apache.felix.shell.remote</code> and <code>org.apache.felix.gogo.shell</code> and comment or remove the bundles
<code>org.apache.felix.gogo.jline</code> and <code>jline</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.apache.felix",   name: "org.apache.felix.shell.remote",  version: "&lt;version&gt;"
osgibundles group: "org.apache.felix",   name: "org.apache.felix.gogo.shell",    version: "&lt;version&gt;"

//osgibundles group: "org.apache.felix", name: "org.apache.felix.gogo.jline",    version: "&lt;version&gt;"
//osgibundles group: "org.jline",        name: "jline",                          version: "&lt;version&gt;"</pre>
</div>
</div>
<div class="paragraph">
<p>To access OpenMUC you can either use</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc remote-shell</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre>telnet 127.0.0.1 6666</pre>
</div>
</div>
<div class="paragraph">
<p>To exit the remote shell without stopping OpenMUC press <code>ctrl+d</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_auto_start_at_boot_time">5.7. Auto Start at Boot Time</h3>
<div class="paragraph">
<p>On Debian based Linux distributions it is easy to configure automatic start of OpenMUC at boot time.
As root execute the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ln -s /path/to/openmuc/bin/openmuc /etc/init.d/openmuc
update-rc.d openmuc defaults</pre>
</div>
</div>
<div class="paragraph">
<p>The above solution will not work if the openmuc start script is located on a partion that is not yet mounted at the time the boot process attempts to open it.
In this case you need copy the start script to /etc/init.d/ and edit it to set the OPENMUC_HOME variable.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_drivers">6. Drivers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_install_a_driver">6.1. Install a Driver</h3>
<div class="paragraph">
<p>For installing a new driver you have two possible ways.</p>
</div>
<div class="sect3">
<h4 id="_copy_driver">6.1.1. Copy driver</h4>
<div class="paragraph">
<p>Copy the corresponding driver jar file from the folder "build/libs-all/" to the
"bundle" folder of the framework. Many drivers are "fat jars" which include their
dependencies. An exception is the RXTX library which cannot be packed
with the jars.</p>
</div>
</div>
<div class="sect3">
<h4 id="_editing_bundles_configuration">6.1.2. Editing bundles configuration</h4>
<div class="paragraph">
<p>In /openmuc/framework/conf/bundles.conf.gradle you can find the list of all used
bundles e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.openmuc.framework", name: "openmuc-driver-csv", version: openmucVersion

osgibundles group: "org.openmuc.framework", name: "openmuc-webui-spi",  version: openmucVersion
osgibundles group: "org.openmuc.framework", name: "openmuc-webui-base", version: openmucVersion</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to add a new driver to the list, e.g. M-Bus, you can do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.openmuc.framework", name: "openmuc-driver-csv",  version: openmucVersion
osgibundles group: "org.openmuc.framework", name: "openmuc-driver-mbus", version: openmucVersion
osgibundles group: "org.openmuc",           name: "jrxtx",               version: "1.0.1"

osgibundles group: "org.openmuc.framework", name: "openmuc-webui-spi",   version: openmucVersion
osgibundles group: "org.openmuc.framework", name: "openmuc-webui-base",  version: openmucVersion</pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards you have to execute in /openmuc/framework/bin/</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./openmuc update-bundles</pre>
</div>
</div>
<div class="paragraph">
<p>If this is the first time using ./openmuc update-bundles you have to add the parameter -i</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./openmuc update-bundles -i</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_use_a_driver_with_serial_communication">6.1.3. Use a Driver with Serial Communication</h4>
<div class="paragraph">
<p>When you need to use a driver that uses serial communication you have
to copy the RXTX bundle to the frameworks "bundle" folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cp ../dependencies/rxtx/jrxtx-1.0.1.jar ./bundle/</pre>
</div>
</div>
<div class="paragraph">
<p>Additionally you need to install librxtx-java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo apt-get install librxtx-java</pre>
</div>
</div>
<div class="paragraph">
<p>The serial ports /dev/tty* are only accessible to members belonging to
the group dialout. We therefore have to add our user to that
group. E.g. using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo adduser &lt;yourUserName&gt; dialout</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modbus">6.2. Modbus</h3>
<div class="paragraph">
<p>Modbus Homepage: <a href="http://www.modbus.org" class="bare">http://www.modbus.org</a><br>
Modbus Protocol Specifications: <a href="http://www.modbus.org/specs.php" class="bare">http://www.modbus.org/specs.php</a><br>
Modbus Master Simulator modpoll: <a href="http://www.modbusdriver.com/modpoll.html" class="bare">http://www.modbusdriver.com/modpoll.html</a></p>
</div>
<div class="paragraph">
<p>The Modbus driver supports RTU, TCP and RTU over TCP.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><strong>TCP</strong> (ethernet)</th>
<th class="tableblock halign-left valign-top"><strong>RTU</strong> (serial)</th>
<th class="tableblock halign-left valign-top"><strong>RTUTCP</strong> (serial over ethernet)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">modbus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;ip&gt;[:&lt;port&gt;]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;serial port&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;ip&gt;[:&lt;port&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;type&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;type&gt;:&lt;encoding&gt;:&lt;baudrate&gt;:&lt;databits&gt;:&lt;parity&gt;:&lt;stopbits&gt;:
&lt;echo&gt;:&lt;flowControlIn&gt;:&lt;flowControlOut&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;type&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">&lt;UnitId&gt;:&lt;PrimaryTable&gt;:&lt;Address&gt;:&lt;Datatyp&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>DeviceAddress</strong></p>
</div>
<div class="paragraph">
<p><strong>For TCP and RTUTCP</strong><br>
The DeviceAddress is specified by an IP address and an optional port. If no port
 is specified, the driver uses the modbus default port 502.</p>
</div>
<div class="paragraph">
<p><strong>For RTU:</strong><br>
The DeviceAddress is specified by a serial port like /dev/ttyS0.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The driver uses the j2mod library which itself uses the rxtx library for
serial communication. Therefore the librxtx-java package needs to be installed on
the system. Furthermore the user needs to be in the groups dialout and plugdev
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Settings</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Config</th>
<th class="tableblock halign-left valign-top">Description/ Values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;type&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RTU|TCP|RTUTCP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;encoding&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERIAL_ENCODING_RTU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;baudrate&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer value: e.g.: 2400, 9600, 115200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;databits&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DATABITS_5, DATABITS_6, DATABITS_7, DATABITS_8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;parity&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PARITY_EVEN, PARITY_MARK, PARITY_NONE, PARITY_ODD, PARITY_SPACE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;stopbits&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STOPBITS_1, STOPBITS_1_5, STOPBITS_2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;echo&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECHO_TRUE, ECHO_FALSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;flowControlIn&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLOWCONTROL_NONE, FLOWCONTROL_RTSCTS_IN, FLOWCONTROL_XONXOFF_IN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;flowControlOut&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLOWCONTROL_NONE, FLOWCONTROL_RTSCTS_OUT, FLOWCONTROL_XONXOFF_OUT</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example Settings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;settings&gt;</span>
RTU:SERIAL_ENCODING_RTU:38400:DATABITS_8:PARITY_NONE:STOPBITS_1 :ECHO_FALSE:FLOWCONTROL_NONE:FLOWCONTROL_NONE
<span class="tag">&lt;/settings&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>ChannelAddress</strong></p>
</div>
<div class="paragraph">
<p>The ChannelAddress consists of four parts: UnitId, PrimaryTable, Address and
Datatyp which are explained in detail in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Parameter Description</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UnitId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In homogenious architecture (when just MODBUS TCP/IP is used)<br>
On TCP/IP, the MODBUS server is addressed by its IP address; therefore, the MODBUS
Unit Identifier is useless. The value 255 (0xFF) has to be used.</p>
<p class="tableblock">In heterogeneous architecture (when using MODBUS TCP/IP and MODBUS serial or MODBUS+)<br>
This field is used for routing purpose when addressing a device on a MODBUS+ or
MODBUS serial line sub-network. In that case, the Unit Identifier carries the MODBUS
slave address of the remote device. The MODBUS slave device addresses on serial line are
assigned from 1 to 247 (decimal). Address 0 is used as broadcast address.</p>
<p class="tableblock">Note: Some MODBUS devices act like a bridge or a gateway and require the UnitId
even if they are accessed through TCP/IP. One of those devices is the Janitza
UMG. To access data from the Janitza the UnitId has to be 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PrimaryTable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PrimaryTable defines the which part of the device memory should
be accessed.
Valid values: COILS, DISCRETE_INPUTS, INPUT_REGISTERS, HOLDING_REGISTERS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address of the channel/register. Decimal integer value - not hex!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datatyp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid values:<br>
BOOLEAN  (1 bit)<br>
INT16    (1 register/word, 2 bytes)<br>
UINT16   (1 register/word, 2 bytes)<br>
INT32    (2 registers/words, 4 bytes)<br>
UINT32   (2 registers/words, 4 bytes)<br>
LONG     (4 registers/words, 8 bytes)<br>
FLOAT    (2 registers/words, 4 bytes)<br>
DOUBLE   (4 registers/words, 8 bytes)<br>
BYTEARRAY[n] (n = number of REGISTERS not BYTES, 1 register = 2 bytes!)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To store a UINT32 value it requires <code>&lt;valueType&gt;LONG&lt;/valueType&gt;</code> for the channel.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Primary Tables and Channel Address</div>
<p><span class="image"><a class="image" href="../images/driver_modbustcp_address.png"><img src="./images/driver_modbustcp_address.png" alt="Driver Modbus Address" width="80%"></a></span></p>
</div>
<div class="paragraph">
<p><strong>Valid Address Parameter Combinations</strong></p>
</div>
<div class="paragraph">
<p>Since COILS and DISCRETE_INPUTS are used for bit access, only the data type BOOLEAN
makes sense in combinations with of one of these. INPUT_REGISTERS and HOLDING_REGISTERS
are used for register access. There is also a difference between reading and writing.
Only COILS and HOLDING_REGISTERS are readable and writable.
DISCRETE_INPUTS and INPUT_REGISTERS are read only. The following table gives an
overview of valid parameter combinations of PrimaryTable and Datatyp.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Valid Address Parameters for reading a channel</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Primary Table</th>
<th class="tableblock halign-center valign-top">BOOLEAN</th>
<th class="tableblock halign-center valign-top">SHORT</th>
<th class="tableblock halign-center valign-top">INT</th>
<th class="tableblock halign-center valign-top">FLOAT</th>
<th class="tableblock halign-center valign-top">DOUBLE</th>
<th class="tableblock halign-center valign-top">LONG</th>
<th class="tableblock halign-center valign-top">BYTEARRAY[n]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">COILS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">DISCRETE_INPUTS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">INPUT_REGISTERS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">HOLDING_REGISTERS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Valid Address Parameters for writing a channel</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Primary Table</th>
<th class="tableblock halign-center valign-top">BOOLEAN</th>
<th class="tableblock halign-center valign-top">SHORT</th>
<th class="tableblock halign-center valign-top">INT</th>
<th class="tableblock halign-center valign-top">FLOAT</th>
<th class="tableblock halign-center valign-top">DOUBLE</th>
<th class="tableblock halign-center valign-top">LONG</th>
<th class="tableblock halign-center valign-top">BYTEARRAY[n]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">COILS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">DISCRETE_INPUTS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">INPUT_REGISTERS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">HOLDING_REGISTERS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Examples for valid addresses</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:INPUT_REGISTERS:100:SHORT<span class="tag">&lt;/channelAddress&gt;</span>
<span class="tag">&lt;channelAddress&gt;</span>255:COILS:412:BOOLEAN<span class="tag">&lt;/channelAddress&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Examples for invalid addresses</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:INPUT_REGISTERS:100:BOOLEAN<span class="tag">&lt;/channelAddress&gt;</span> (BOOLEAN doesn't
go with INPUT_REGISTERS)
<span class="tag">&lt;channelAddress&gt;</span>255:COILS:412:LONG<span class="tag">&lt;/channelAddress&gt;</span> (LONG does not go with COILS)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Function Codes</strong> (more detailed information about how the driver works)</p>
</div>
<div class="paragraph">
<p>The driver is based on the Java Modbus Library (<a href="https://github.com/steveohara/j2mod">j2mod</a>)
which provides read and write access via modbus.
Following table shows which modbus function code is used to access the data of
the channel.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Relation between function code and channel address</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">j2mod Method</th>
<th class="tableblock halign-left valign-top">Modbus Function Code</th>
<th class="tableblock halign-left valign-top">Primary Table</th>
<th class="tableblock halign-left valign-top">Access</th>
<th class="tableblock halign-left valign-top">Java Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadCoilsRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 1  Read Coils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadInputDiscretesRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 2  Read Discrete Inputs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discrete Inputs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadMultipleRegistersRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 3  Read Holding Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holding Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short, int, double, long, float, bytearray[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadInputRegistersRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 4  Read Input Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short, int, double, long, float, bytearray[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WriteCoilRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 5  Write Single Coil</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WriteMultipleCoilsRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 15 Write Multiple Coils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WriteMultipleRegistersRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC  6  Write Single Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holding Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short, int, double, long, float, bytearray[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WriteMultipleRegistersRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 16  Write Multiple Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holding Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short, int, double, long, float, bytearray[]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:INPUT_REGISTERS:100:SHORT<span class="tag">&lt;/channelAddress&gt;</span> will be accessed
via function code 4.</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_modbus_tcp_and_wago">6.2.1. Modbus TCP and Wago</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Till now the driver has been tested with some modules of the Wago 750 Series
with the Fieldbus-Coupler 750-342
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to use the Modbus TCP driver for accessing a Wago device you first
need to know how the process image is build. From the process image you can
derive the register addresses of your Wago modules (AO, AI, DO, DI). You find
detailed information about the process image in
<a href="http://www.wago.com/wagoweb/documentation/750/eng_manu/coupler_controller/m07500342_00000000_0en.pdf">WAGO 750-342 Manual</a>
on page 46 and 47.</p>
</div>
<div class="paragraph">
<p>The following Examples are based on figure <a href="#wago">Wago 750-342 Process Image</a><br></p>
</div>
<div class="paragraph">
<p>*Example 1: Read AI 2 from first (left) 472-module (Register Address 0x0001)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:INPUT_REGISTERS:1:SHORT<span class="tag">&lt;/channelAddress&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example 2: Read DI 3 from first (left) 472-module (Register Address 0x0003)</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:DISCRETE_INPUTS:3:BOOLEAN<span class="tag">&lt;/channelAddress&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example 3: Write AO 1 from first (left) 550-module (Register Address 0x0000/0x0200)</strong><br></p>
</div>
<div class="paragraph">
<p>For writing only the +0x0200 addresses should be used! Since the driver accepts
only a decimal channelAddress 0x0200 must be converted to decimal. The resulting
address would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:HOLDING_REGISTERS:512:SHORT<span class="tag">&lt;/channelAddress&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example 4: Write DO 2 from 501-module (Register Address 0x0000/0x0201)</strong><br>
For writing only the +0x0200 addresses should be used! Since the driver accepts
only a decimal channelAddress 0x0201 must be converted to decimal. The resulting
address would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:COILS:513:BOOLEAN<span class="tag">&lt;/channelAddress&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example 5: Read back DO 2 from 501-module (Register Address 0x0201)</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:COILS:513:BOOLEAN<span class="tag">&lt;/channelAddress&gt;</span> or
<span class="tag">&lt;channelAddress&gt;</span>255:DISCRETE_INPUTS:513:BOOLEAN<span class="tag">&lt;/channelAddress&gt;</span></code></pre>
</div>
</div>
<div id="wago" class="paragraph">
<div class="title">Wago 750-342 Process Image</div>
<p><span class="image"><a class="image" href="images/modbus_wago_process_image.png"><img src="./images/modbus_wago_process_image.png" alt="Driver Modbus Wago process" width="80%"></a></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="anchor-driver-mbus">6.3. M-Bus (wired)</h3>
<div class="paragraph">
<p>M-Bus is communication protocol to read out meters.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">mbus</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;serial_port&gt;:&lt;mbus_address&gt; or
tcp:&lt;host_address&gt;:&lt;port&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[&lt;baudrate&gt;][:timeout][:lr][:ar][:d&lt;delay&gt;]
[:tc&lt;tcp_connection_timeout&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[X]&lt;dib&gt;:&lt;vib&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Device Address</strong></p>
</div>
<div class="paragraph">
<p>&lt;serial_port&gt; - The serial port should be given that connects to the M-Bus converter.
(e.g. /dev/ttyS0, /dev/ttyUSB0 on Linux).</p>
</div>
<div class="paragraph">
<p>&lt;mbus_address&gt; - The mbus adrdess can either be the the primary address or secondary
address of the meter. The primary address is specified as integer
(e.g. 1 for primary address 1) whereas the secondary address consits of 8 bytes
that should be specified in hexadecimal form. (e.g. e30456a6b72e3e4e)</p>
</div>
<div class="paragraph">
<p>tcp - with this option M-Bus over TCP is used.</p>
</div>
<div class="paragraph">
<p>&lt;host_address&gt; - The host address for M-Bus over TCP e.g. 192.168.8.89.</p>
</div>
<div class="paragraph">
<p>&lt;port&gt; - The TCP port for M-Bus over TCP e.g. 5369</p>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="paragraph">
<p>&lt;baudrate&gt; - If left empty the default is used: "2400"</p>
</div>
<div class="paragraph">
<p>&lt;timeout&gt; - Defines the read timeout in ms. Default is 2500 ms. Example: t5000
for timeout of 5 seconds</p>
</div>
<div class="paragraph">
<p>&lt;lr&gt; - Link reset before readout.</p>
</div>
<div class="paragraph">
<p>&lt;ar&gt; - Application reset before readout.</p>
</div>
<div class="paragraph">
<p>d&lt;delay&gt; - Inserts a delay between every message, including link reset and application
reset. Delay in ms.
A delay with 100 ms and activated link reset and application reset results in a total
delay of 300 ms.</p>
</div>
<div class="paragraph">
<p>tc&lt;tcp_connection_timeout&gt; - The TCP connection timeout is need for a defined timeout
when no TCP connection could established.</p>
</div>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>Shall be of the format &lt;dib&gt;:&lt;vib&gt; in a hexadecimal string format (e.g. 04:03 or 02:fd48)
The X option is used for selecting a specific data record.</p>
</div>
</div>
<div class="sect2">
<h3 id="_m_bus_wireless">6.4. M-Bus (wireless)</h3>
<div class="paragraph">
<p>Wireless M-Bus is communication protocol to read out meters and sensors.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">wmbus</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;serial_port&gt;:&lt;secondary_address&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;transceiver&gt; &lt;mode&gt; [&lt;key&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;dib&gt;:&lt;vib&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Device Address</strong></p>
</div>
<div class="paragraph">
<p>&lt;serial_port&gt; - The serial port used for communication. Examples are /dev/ttyS0
(Linux) or COM1 (Windows)</p>
</div>
<div class="paragraph">
<p>&lt;secondary_address&gt; - The secondary address consists of 8 bytes that should be
specified in hexadecimal form. (e.g. e30456a6b72e3e4e)</p>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="paragraph">
<p>&lt;transceiver&gt; - The transceiver being used. It can be 'amber' or 'rc' for modules
from RadioCrafts.</p>
</div>
<div class="paragraph">
<p>&lt;mode&gt; - The wM-Bus mode can be S or T.</p>
</div>
<div class="paragraph">
<p>&lt;key&gt; - The key in hexadecimal form.</p>
</div>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>Shall be of the format &lt;dib&gt;:&lt;vib&gt; in a hexadecimal string format (e.g. 04:03 or 02:fd48)</p>
</div>
</div>
<div class="sect2">
<h3 id="_iec_60870_5_104">6.5. IEC 60870-5-104</h3>
<div class="paragraph">
<p>IEC 60870-5-104 is an international communication standard for telecontrol.
The IEC 60870-5-104 driver uses the library from the j60870 project.<br>
The driver is able to send general interrogation commands for sampling. For writing
almost all commands are possible.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">iec60870</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[ca=&lt;common_address&gt;] [;p=&lt;port&gt;] [;h=&lt;host_address&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mft=&lt;message_fragment_timeout&gt;] [;cfl=&lt;cot_field_length&gt;]
[;cafl=&lt;common_address_field_length&gt;] [;ifl=&lt;ioa_field_length&gt;]
 [;mtnar=&lt;max_time_no_ack_received&gt;] [;mtnas=&lt;max_time_no_ack_sent&gt;]
 [;mit=&lt;max_idle_time&gt;] [;mupr=&lt;max_unconfirmed_ipdus_received&gt;]
  [;sct=&lt;stardt_con_timeout&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ca=&lt;common_address&gt;; t=&lt;type_id&gt;; ioa=&lt;ioa&gt;
[;dt=&lt;data_type&gt;] [;i=&lt;index&gt;] [;m=&lt;multiple&gt;]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All options are separated by a semicolon.</p>
</div>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>Mandatory options are <em>Common Address</em>, <em>Type ID</em> and <em>Information Object Address</em>.</p>
</div>
<div class="paragraph">
<p>It is possible to get a single value of a Sequence Information Element, for this
you can define <em>Index</em> of the needed element. The first element is 0, the second 1, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>For reading values which are divided in multiple elements it can be defined how many
elements should be read as one. e.g. <em>i=0;m=4</em> says it reads from the first element
up to the fourth element, of a sequence. This is only allowed for <em>Binary State Information</em>.</p>
</div>
<div class="paragraph">
<p>With the option <em>Data Type</em> it is possible to get a single quality flag.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Data Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">v</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value (default)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in/valid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not topical</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">substituted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blocked</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ov</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">overflow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ei</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">elapsed time invalid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter was adjusted since last reading</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter overflow occurred in the</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_iec_61850">6.6. IEC 61850</h3>
<div class="paragraph">
<p>IEC 61850 is an international communication standard used mostly for
substation automation and controlling distributed energy resources
(DER). The IEC 61850 driver uses the client library from the
OpenIEC61850 project.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">iec61850</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;host&gt;[:&lt;port&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-a &lt;authentication parameter&gt;] [-lt &lt;local t-selector&gt;] [-rt &lt;remote t-selector&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;bda reference&gt;:&lt;fc&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>The channel address should be the IEC 61850 Object Reference and the
Functional Constraint of the Basic Data Attribute that is to be
addressed separated by a colon.  Note that an IEC 61850 timestamp received will be
converted to a LongValue that represents the milliseconds since
1970. Some information is lost during this conversion because the IEC
61850 timestamp is more exact.</p>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="paragraph">
<p>The defaults for TSelLocal and TSelRemote are "00" and "01"
respectively. You can also set either TSelector to the empty string
(e.g. "-lt -rt"). This way they will be omitted in the connection
request.</p>
</div>
</div>
<div class="sect2">
<h3 id="_iec_62056_part_21">6.7. IEC 62056 part 21</h3>
<div class="paragraph">
<p>The IEC 62056 part 21 driver can be used to read out meter via optical interface</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">iec62056p21</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;serial_port&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-d &lt;baud_rate_change_delay&gt;] [-t &lt;timeout&gt;] [-r &lt;number_of_read_retries&gt;]
[-bd &lt;initial_baud_rate&gt;] [-a &lt;device_address&gt;] [-fbd] [-rsc &lt;request_message_start_character&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;data_set_id&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Device Address</strong></p>
</div>
<div class="paragraph">
<p>&lt;serial_port&gt; - The serial port should be given that connects to the M-Bus converter.
(e.g. /dev/ttyS0, /dev/ttyUSB0 on Linux).</p>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="paragraph">
<p><em>Baud rate change delay</em> <em>-d</em> sets the waiting time in milliseconds between a
baud rate change default is 0.<br>
<em>Timeout</em> <em>-t</em> sets the response timeout in milliseconds, default is 2000.<br>
<em>Number of read retries</em> <em>-r</em>  defines the maximum of read retries, default is 0.<br>
<em>Baud rate</em> <em>-bd</em> sets a initial baud rate e.g. for devices with modem configuration,
default is 300.<br>
<em>Device address</em> <em>-a</em> is mostly needed for devices with RS485, default is no device address.<br>
<em>Fixed baud rate</em> <em>-fbd</em> activates fixed baud rate, default is deactivated.<br>
<em>Request message start character</em> <em>-rsc</em> is used for manufacture specific request
messages. With this option you can change the default start character.<br>
<em>Read standard</em> <em>-rs</em> reads the standard message and the manufacture specific message.
This options has only an affect if the <em>Request message start character</em> is changed.</p>
</div>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>&lt;data_set_id&gt; - Id of the data set. It is usually an OBIS code of the format
A-B:C.D.E*F or on older EDIS code of the format C.D.E.that specifies exactly what
the value of this data set represents.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dlmscosem">6.8. DLMS/COSEM</h3>
<div class="paragraph">
<p>DLMS/COSEM is a international standardized protocol used mostly to communicate
with smart meter devices. The DLMS/COSEM driver uses the client library developed
by the jDLMS project. Currently, the DLMS/COSEM driver supports communication via
HDLC and TCP/IP using Logical Name Referencing to retrieve values from the device.</p>
</div>
<div class="paragraph">
<p><strong>Dependencies:</strong> rxtxcomm_api-2.1.7.jar (optional)</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">dlms</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">t=&lt;serial/tcp&gt; [;h=&lt;inet_address&gt;] [;p=&lt;int&gt;] [;hdlc=&lt;boolean&gt;]<br>
                  [;sp=&lt;sp&gt;] [;bd=&lt;int&gt;] [;d=&lt;d&gt;] [;eh=&lt;eh&gt;] [;iec=&lt;iec&gt;] [;pd=&lt;pd&gt;]<br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[SendDisconnect=&lt;disconnect&gt;];[UseHandshake=&lt;handshake&gt;];[..]
[ld=&lt;int&gt;] [;cid=&lt;cid&gt;] [;sn=&lt;sn&gt;] [;emech=&lt;emech&gt;] [;amech=&lt;amech&gt;]<br>
 [;ekey=&lt;ekey&gt;] [;akey=&lt;akey&gt;] [;pass=&lt;pass&gt;] [;cl=&lt;cl&gt;] [;rt=&lt;rt&gt;] [;mid=&lt;mid&gt;] [;did=&lt;did&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;class-id&gt;/&lt;reference-id&gt;/&lt;attribute-id&gt;[;t=&lt;data_object_type&gt;]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Device Address</strong></p>
</div>
<div class="paragraph">
<p>The interface address consists of all elements the driver needs to uniquely
identify and address a physical smart meter and format depends on the used protocol.
Refer to the following table for the format of the interface address.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Device Address connection type</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top"><em>serial/tcp</em></th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>serial/tcp</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>serial</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial port e.g. sp=/dev/ttyS0 or sp=COM1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>serial</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9600</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baud rate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tcp</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host name e.g. h=127.0.0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">p</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tcp</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4059</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdlc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>both</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses HDLC if true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>both</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baud rate change delay in milliseconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>flag</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>both</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use initial handshake to negotiate baud rate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>both</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEC 21 address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>both</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Device Address</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Example</div>
<p>Serial with HDLC on serial port ttyUSB0 an 9600 baud:<br>
<em>t=serial;sp=/dev/ttyUSB0;bd=9600;hdlc=true</em></p>
</div>
<div class="paragraph">
<p>TCP with HDLC to host 192.168.85.99 on port 5081:<br>
<em>t=tcp;h=192.168.85.99;p=5081;hdlc=true</em></p>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="paragraph">
<p>Settings are separated by a semi-colon. The available settings are determined by
the used protocol, defined as first parameter of the device address. All possible
settings with a short description and default values are listed in the following
table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Settings</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ld</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical Device Address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use SN referencing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">emech</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption Mechanism</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">amech</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Mechanism</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ekey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>hex_value</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption Key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">akey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>hex_value</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorisation password to access the smart meter device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Challenge Length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response Timeout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MMM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manufacturer Id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">did</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>long</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Id</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Device Address additional options</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address in logical name format &lt;Interface_Class_ID&gt;/&lt;Instance_ID&gt;/&lt;Object_Attribute_ID&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Object Type</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_knx">6.9. KNX</h3>
<div class="paragraph">
<p>KNX is a standardised protocol for intelligent buildings. The KNX
driver uses KNXnet/IP to connect to the wired KNX BUS. The driver
supports group read and writes and is also able to listen to the
BUS. The driver uses the calimero library.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">knx</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">knxip://&lt;host_ip&gt;[:&lt;port&gt;] knxip://&lt;device_ip&gt;[:&lt;port&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[Address=&lt;Individual KNX address (e. g. 2.6.52)&gt;];[SerialNumber=&lt;Serial number&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;Group Adress&gt;:&lt;DPT_ID&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Device Address</strong></p>
</div>
<div class="paragraph">
<p>The device address consists of the host IP and the IP of the KNX tunnel or router.</p>
</div>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>The channel address consist of the group address you want to monitor and the
corresponding data point ID. A data point consists of a main number and a subtype.
For example a boolean would be represented by the main number 1 and a switch by
the subtype 001, the DPT_ID of a switch is 1.001.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ehz">6.10. eHZ</h3>
<div class="paragraph">
<p>OpenMUC driver for SML and IEC 62056-21</p>
</div>
<div class="paragraph">
<p><strong>Dependencies:</strong> rxtxcomm_api-2.1.7.jar</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">ehz</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sml://&lt;serialPort&gt; or iec://&lt;serialPort&gt;  e.g. sml:///dev/ttyUSB0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;OBIScode&gt; e.g. 10181ff (not 1-0:1.8.1*255)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>scanForDevices() and scanForChannels will return the specific configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_snmp">6.11. SNMP</h3>
<div class="paragraph">
<p>Simple Network Management Protocol (SNMP) is an Internet-standard protocol for
monitoring and management of devices on IP networks.</p>
</div>
<div class="paragraph">
<p><strong>Dependencies:</strong> snmp4j-2.2.5.jar</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">snmp</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP/snmpPort</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP OID address</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Device Address</strong></p>
</div>
<div class="paragraph">
<p>IP address and available SNMP port of the target device should be provided as Device Address.</p>
</div>
<div class="paragraph">
<p><strong>Example for Device Address:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>192.168.1.1/161</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="paragraph">
<p>All settings are stored in "SnmpDriverSettingVariableNames" enum.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Setting Parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SNMPVersion</th>
<th class="tableblock halign-left valign-top">"SNMPVersion" enum contains all available values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">USERNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SECURITYNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AUTHENTICATIONPASSPHRASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">is the same COMMUNITY word in SNMP V2c</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRIVACYPASSPHRASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>SNMPVersion</strong></p>
</div>
<div class="paragraph">
<p>SNMPVersion is an enum variable containing valid SNMP versions. (V1, V2c, V3)</p>
</div>
<div class="paragraph">
<p><strong>Example for valid settings string:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>SNMPVersion=V2c:USERNAME=public:SECURITYNAME=public:AUTHENTICATIONPASSPHRASE=password</pre>
</div>
</div>
<div class="paragraph">
<p>In order to read specific channel, corresponding SNMP OID shall be passed.</p>
</div>
<div class="paragraph">
<p><strong>Example for SNMP OID:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>1.3.6.1.2.1.1.1.0</pre>
</div>
</div>
<div class="paragraph">
<p>For scanning SNMP enabled devices in the network, range of IP addresses shall be
provided. This functionality is implemented only for SNMP V2c.</p>
</div>
</div>
<div class="sect2">
<h3 id="_csv">6.12. CSV</h3>
<div class="paragraph">
<p>The csv driver supports sampling from a csv file. This feature can be very helpful during application development or show cases, when no real hardware is available. For example, our SimpleDemoApp uses data provided by the csv driver.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">csv</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path to csv file (e.g. /path/to/my.csv)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">samplingmode=&lt;samplingmode&gt;[;rewind=&lt;rewind&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">column name</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Samplingmode</strong> configures how the csv file is sampled. Currently, three different modes are supported:</p>
<div class="ulist">
<ul>
<li>
<p>line - starts sampling from the first line of the csv file. Timestamps are ignored and each sampling reads the next line.</p>
</li>
<li>
<p>unixtimestamp - csv file must contain a column with the name <em>unixtimestamp</em>, values must be in milliseconds. During sampling the driver searches the closest unixtimestamp which is &gt;= the sampling timestamp. Therefore, the driver keeps returning the same value for sampling timestamps which are before the next unixtimestamp of the csv file.</p>
</li>
<li>
<p>hhmmss - csv file must contain a column with the name <em>hhmmss</em> and the time values must be in the format: hhmmss.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>rewind</strong> - If <em>true</em> and the last line of the csv file is reached, then the driver will start sampling again from first line. This option can only be used in combination with sampling mode <em>hhmmss</em> or <em>line</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The columns <em>unixtimestamp</em> and <em>hhmmss</em> are part of the log files created by the AsciiLogger, therefore the csv driver supports these files.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration for csv driver</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;device</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smarthome</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;description</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;deviceAddress&gt;</span>./csv-driver/smarthome.csv<span class="tag">&lt;/deviceAddress&gt;</span>
  <span class="tag">&lt;settings&gt;</span>samplingmode=hhmmss;rewind=true<span class="tag">&lt;/settings&gt;</span>
  <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">power_pv</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;channelAddress&gt;</span>power_photovoltaics<span class="tag">&lt;/channelAddress&gt;</span>
    <span class="tag">&lt;unit&gt;</span>W<span class="tag">&lt;/unit&gt;</span>
    <span class="tag">&lt;samplingInterval&gt;</span>5s<span class="tag">&lt;/samplingInterval&gt;</span>
    <span class="tag">&lt;loggingInterval&gt;</span>5s<span class="tag">&lt;/loggingInterval&gt;</span>
<span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aggregator">6.13. Aggregator</h3>
<div class="paragraph">
<p>The Aggregator which performs aggregation of logged values from a channel. It
uses the DriverService and the DataAccessService. It is therefore a kind of
OpenMUC driver/application mix. The aggregator is fully configurable through the
channels.xml config file.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">aggregator</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">virtual device e.g "aggregatordevice"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;sourceChannelId&gt;:&lt;aggregationType&gt;[:&lt;quality&gt;]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>&lt;sourceChannelId&gt; - id of channel to be aggregated</p>
</div>
<div class="paragraph">
<p>&lt;aggregationType&gt; -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AVG: calculates the average of all values of interval (e.g. for average power)</p>
</li>
<li>
<p>LAST: takes the last value of interval (e.g. for energy)</p>
</li>
<li>
<p>DIFF: calculates difference of first and last value of interval</p>
</li>
<li>
<p>PULS_ENERGY,&lt;pulses per Wh&gt;,&lt;max counter&gt;: calculates energy from pulses of
interval (e.g. for pulse counter/meter). Example: PULSE_ENERGY,10,65535</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>&lt;quality&gt; - Range 0.0 - 1.0. Percentage of the expected valid/available logged
records for aggregation. Default value is 1.0. Example: Aggregation of 5s values
to 15min. The 15min interval consists of 180 5s values. If quality is 0.9 then at
least 162 of 180 values must be valid/available for aggregation.
NOTE: The missing/invalid values could appear as block at the beginning or end
of the interval, which might be problematic for some aggregation types</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>Channel A (channelA) is sampled and logged every 10 seconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;channelid</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">channelA</span><span class="error">&quot;</span><span class="tag">&gt;</span>
   <span class="tag">&lt;samplingInterval&gt;</span>10s<span class="tag">&lt;/samplingInterval&gt;</span>
   <span class="tag">&lt;loggingInterval&gt;</span>10s<span class="tag">&lt;/loggingInterval&gt;</span>
 <span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you want a channel B (channelB) which contains the same values as channel A
but in a 1 minute resolution by using the 'average' as aggregation type. You can
achieve this by simply adding the aggregator driver to your channel config file
and define a the channel B as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;driver</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aggregator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;device</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aggregatordevice</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
     <span class="tag">&lt;channelid</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">channelB</span><span class="error">&quot;</span><span class="tag">&gt;</span>
       <span class="tag">&lt;channelAddress&gt;</span>channelA:avg<span class="tag">&lt;/channelAddress&gt;</span>
       <span class="tag">&lt;samplingInterval&gt;</span>60s<span class="tag">&lt;/samplingInterval&gt;</span>
       <span class="tag">&lt;loggingInterval&gt;</span>60s<span class="tag">&lt;/loggingInterval&gt;</span>
     <span class="tag">&lt;/channel&gt;</span>
   <span class="tag">&lt;/device&gt;</span>
 <span class="tag">&lt;/driver&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The new (aggregated) channel has the id channelB. The channel address consists of
the channel id of the original channel and the aggregation type which is channelA:avg
in this example. OpenMUC calls the read method of the aggregator every minute. The
aggregator then gets all logged records from channelA of the last minute, calculates
the average and sets this value for the record of channelB.
NOTE: It&#8217;s recommended to specify the samplingTimeOffset for channelB. It should
be between samplingIntervalB - samplingIntervalA and samplingIntervalB. In this
example: 50 &lt; offset &lt; 60. This constraint ensures that values are AGGREGATED
CORRECTLY. At hh:mm:55 the aggregator gets the logged values of channelA and at
hh:mm:60 respectively hh:mm:00 the aggregated value is logged.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;driver</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aggregator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;device</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aggregatordevice</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
     <span class="tag">&lt;channelid</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">channelB</span><span class="error">&quot;</span><span class="tag">&gt;</span>
       <span class="tag">&lt;channelAddress&gt;</span>channelA:avg<span class="tag">&lt;/channelAddress&gt;</span>
       <span class="tag">&lt;samplingInterval&gt;</span>60s<span class="tag">&lt;/samplingInterval&gt;</span>
       <span class="tag">&lt;samplingTimeOffset&gt;</span>55s<span class="tag">&lt;/samplingTimeOffset&gt;</span>
       <span class="tag">&lt;loggingInterval&gt;</span>60s<span class="tag">&lt;/loggingInterval&gt;</span>
     <span class="tag">&lt;/channel&gt;</span>
   <span class="tag">&lt;/device&gt;</span>
 <span class="tag">&lt;/driver&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_restjson">6.14. REST/JSON</h3>
<div class="paragraph">
<p>Driver to connect an OpenMUC instance with an remote OpenMUC instance with REST.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">rest</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http(s)://&lt;address&gt;:&lt;port&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[ct;]&lt;username&gt;:&lt;password&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;channelID&gt;</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>host_address: the address of the remote OpenMUC eg. 127.0.0.1</p>
</li>
<li>
<p>port: the port of the remote OpenMUC eg. 8888</p>
</li>
<li>
<p>ct: this optional flag defines if the driver should check the remote timestamp, before reading the complete record</p>
</li>
<li>
<p>username: the username of the remote OpenMUC</p>
</li>
<li>
<p>password: the pasword of the remote OpenMUC</p>
</li>
<li>
<p>channelID: the ID of the remote OpenMUC</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Supported features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>read channel</p>
</li>
<li>
<p>write channel</p>
</li>
<li>
<p>scan for all channels</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Not supported features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>scan for devices</p>
</li>
<li>
<p>reading whole devices instead of single channel</p>
</li>
<li>
<p>listening</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>Connecting to an remote OpenMUC instance (192.168.8.18:8888) and reading the channel "power_grid"
every 5s if the timestamp has changed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;driver</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;device</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example_rest_device</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;deviceAddress&gt;</span>http://192.168.8.18:8888<span class="tag">&lt;/deviceAddress&gt;</span>
      <span class="tag">&lt;settings&gt;</span>ct;admin:admin<span class="tag">&lt;/settings&gt;</span>
      <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">power_grid_rest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;channelAddress&gt;</span>power_grid<span class="tag">&lt;/channelAddress&gt;</span>
        <span class="tag">&lt;samplingInterval&gt;</span>5s<span class="tag">&lt;/samplingInterval&gt;</span>
      <span class="tag">&lt;/channel&gt;</span>
   <span class="tag">&lt;/device&gt;</span>
<span class="tag">&lt;/driver&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_amqp">6.15. AMQP</h3>
<div class="paragraph">
<p>Connects OpenMUC with an AMQP-Broker and writes the records from the queues to channels.
Therefore this driver makes usage of our AMQP-Library, which is described in section <a href="#amqp-lib">[amqp-lib]</a>. For configuration
of the AMQP-Connection, the values from the following table have to be set in the channels.xml.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">amqp</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of the amqp infrastructure</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">port=&lt;port&gt;;vhost=&lt;vHost&gt;;user=&lt;user&gt;;password=&lt;pw&gt;;framework=&lt;frameworkID&gt;;
parser=&lt;needed <a href="#parser-lib">Parser-Service</a>&gt;;buffersize=&lt;1-n&gt;;ssl=&lt;true/false&gt;;separator=&lt;e.g. "_"&gt;;exchange=&lt;amqp-exchange&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;name of amqp-queue&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Parameter description:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>framework and separator:<br>
To add the information about the source of an amqp queue, the concept of subsection
<a href="#amqp-mapping">Mapping to AMQP-Queues</a> is used. Framework defines the prefix of the amqp queue and seperator the char between
framework and channelID.</p>
</li>
<li>
<p>buffersize:<br>
This parameter makes it possible to optimize the performance at listening and logging huge amounts of records.
The driver waits till it collected the configured number of records, before it returns the whole list to the
data manager. This decreases the number of needed tasks e.g. for writing to a database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Supported features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>read channel</p>
</li>
<li>
<p>write channel</p>
</li>
<li>
<p>listening</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Not supported features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>scan for devices</p>
</li>
<li>
<p>scan for all channels</p>
</li>
<li>
<p>reading whole devices instead of single channel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After starting this bundle, it connects to the configured amqp host.
The example below is listening for the queue "SmartMeter_power_grid".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;driver</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">amqp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;device</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Smart Meter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
       <span class="tag">&lt;deviceAddress&gt;</span>myAmqpBroker.de<span class="tag">&lt;/deviceAddress&gt;</span>
        <span class="tag">&lt;settings&gt;</span>
        port=5671;vhost=myVHost;user=openmuc;password=Password123;framework=SmartMeter;
        parser=openmuc;buffersize=1;ssl=true;separator=_;exchange=field1
        <span class="tag">&lt;/settings&gt;</span>
            <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">power_grid</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;channelAddress&gt;</span>power_grid<span class="tag">&lt;/channelAddress&gt;</span>
                <span class="tag">&lt;listening&gt;</span>true<span class="tag">&lt;/listening&gt;</span>
        <span class="tag">&lt;/channel&gt;</span>
   <span class="tag">&lt;/device&gt;</span>
<span class="tag">&lt;/driver&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mqtt">6.16. MQTT</h3>
<div class="paragraph">
<p>The MQTT-Driver connects OpenMUC to a MQTT-Broker. It enables OpenMUC to listen on topics and write records and
messages to topics. The driver is based on our MQTT-Library, which is described in section <a href="#mqtt-lib">[mqtt-lib]</a>. For configuration
of the MQTT-Connection, the values from the following table have to be set in the channels.xml.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">mqtt</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of the mqtt broker</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">port=&lt;port&gt;;parser=&lt;needed <a href="#parser-lib">Parser-Service</a>&gt;[;username=&lt;user&gt;;password=&lt;pw&gt;]
[;recordCollectionSize=&lt;1-n&gt;][;ssl=&lt;true/false&gt;][;maxBufferSize=&lt;0-n&gt;;maxFileSize=&lt;0-n&gt;;maxFileCount=&lt;0-n&gt;]
[;connectionRetryInterval=&lt;s&gt;][;connectionAliveInterval=&lt;s&gt;][;firstWillTopic=&lt;topic&gt;;firstWillPayload=&lt;payload&gt;]
[;lastWillTopic=&lt;topic&gt;;lastWillPayload=&lt;payload&gt;][;lastWillAlways=&lt;true/false&gt;]
[;persistenceDirectory=&lt;data/driver/mqtt&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;name of mqtt-topic&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Parameter description:</strong></p>
</div>
<div class="paragraph">
<p>Parameters marked with [ ] are optional parameters.<br>
<strong>NOTE:</strong> If optional parameters are used, then <strong><em>all</em></strong> parameters included in the brackets need to be
specified (see grouping above).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>port:</strong> Port for MQTT communication</p>
</li>
<li>
<p><strong>parser:</strong> Identifier of needed parser implementation e.g. <em>openmuc</em></p>
</li>
<li>
<p><strong>[username]:</strong> Name of your MQTT account</p>
</li>
<li>
<p><strong>[password]:</strong> Password of your MQTT account</p>
</li>
<li>
<p><strong>[recordCollectionSize]</strong>:<br>
This parameter makes it possible to optimize the performance of listening and logging huge amounts of records.
The driver waits until the configured number of records is collected, before returning the list to the
data manager. This decreases the number of needed tasks e.g. for writing to a database.</p>
</li>
<li>
<p><strong>[ssl]:</strong> <em>true</em> enable ssl, <em>false</em> disable ssl</p>
</li>
<li>
<p><strong>[maxBufferSize]:</strong> Max buffer size in kB. If limit is reached than buffer will be written to file.</p>
</li>
<li>
<p><strong>[maxFileSize]:</strong> Max file size in kB. If</p>
</li>
<li>
<p><strong>[maxFileCount]:</strong> Number of files to be created for buffering</p>
</li>
<li>
<p><strong>[connectionRetryInterval]:</strong> Connection retry interval in s  reconnect after given seconds when connection fails</p>
</li>
<li>
<p><strong>[connectionAliveInterval]:</strong> Connection alive interval in s  periodically send PING message to broker to detect broken connections</p>
</li>
<li>
<p><strong>[firstWillTopic]:</strong> Topic on which firstWillPayload will be published on successful connections</p>
</li>
<li>
<p><strong>[firstWillPayload]:</strong> Payload of the first will message</p>
</li>
<li>
<p><strong>[lastWillTopic]:</strong> Topic on which lastWillPayload will be published</p>
</li>
<li>
<p><strong>[lastWillPayload]:</strong> Payload of the last will message</p>
</li>
<li>
<p><strong>[lastWillAlways]:</strong> <em>true</em>: publish last will payload on every disconnection, including intended disconnects by the
client. <em>false</em> publish only on errors/connection interrupts</p>
</li>
<li>
<p><strong>[persistenceDirectory]:</strong> directory to store data for file buffering e.g. <em>data/driver/mqtt&gt;</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To get a more clean looking channels.xml it is also possible to use line breaks instead of semicolons or a mix of both.</p>
</div>
<div class="paragraph">
<p><strong>Supported features:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>write channel</p>
</li>
<li>
<p>listening</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Not supported features:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>read channel</p>
</li>
<li>
<p>scan for devices</p>
</li>
<li>
<p>scan for all channels</p>
</li>
<li>
<p>reading whole devices instead of single channel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After starting this bundle, it connects to the configured mqtt host.
The example below is listening for the topic "SmartMeter/power_grid".
It also uses firstWill and lastWill for sending connection status messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;driver</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mqtt</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;device</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Smart Meter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
       <span class="tag">&lt;deviceAddress&gt;</span>myMqttBroker.de<span class="tag">&lt;/deviceAddress&gt;</span>
        <span class="tag">&lt;settings&gt;</span>
        port=1883;username=openmuc;password=Password123
        parser=openmuc;bufferSize=2;ssl=true
        lastWillTopic=my/topic;lastWillPayload=Offline;lastWillAlways=true
        firstWillTopic=my/topic;firstWillPayload=Online
        <span class="tag">&lt;/settings&gt;</span>
            <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">power_grid</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;channelAddress&gt;</span>SmartMeter/power_grid<span class="tag">&lt;/channelAddress&gt;</span>
                <span class="tag">&lt;listening&gt;</span>true<span class="tag">&lt;/listening&gt;</span>
        <span class="tag">&lt;/channel&gt;</span>
   <span class="tag">&lt;/device&gt;</span>
<span class="tag">&lt;/driver&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="anchor-dataloggers">7. Dataloggers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ascii_logger">7.1. ASCII Logger</h3>
<div class="sect3">
<h4 id="_general_information">7.1.1. General Information</h4>
<div class="paragraph">
<p>The log files adhere to the following naming scheme: YYYYMMDD_loggingInterval.dat
If you have channels with different logging intervals or change a channels logging interval a new file is created
for that logging interval. If OpenMUC is stopped and restarted on the same day or there are problems like a power
outage that create holes in the data, new files will be created for this date while the old ones will be renamed
.old or .old2 .old3 etc. in case it happens multiple times on one day.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">loggerId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asciilogger</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph">
<p><a href="#anchor-channel-options">channel options</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingSettings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not supported</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_configuration">7.1.2. Configuration</h4>
<div class="paragraph">
<p>For the ASCII Logger there are two options you can change.</p>
</div>
<div class="paragraph">
<p>You can choose whether you want enable file filling mode instead of renaming asciidata files to *.old after a
OpenMUC restart. This will fill the time frame without data with data points that show err32 for every channels
value. You do this by adding the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.openmuc.framework.datalogger.ascii.fillUpFiles = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The other option concerns the file path of the logger. By default it is set to &lt;openmuc_folder&gt;/data/ascii or
you can change it through adding this line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.openmuc.framework.datalogger.ascii.directory = &lt;path&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_structure">7.1.3. Structure</h4>
<div class="paragraph">
<p>The log files' header shows you the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ies format version</p>
</li>
<li>
<p>file name</p>
</li>
<li>
<p>file info</p>
</li>
<li>
<p>timezone relative to gmt (i.e. +1)</p>
</li>
<li>
<p>timestep_sec (time between entries in seconds)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It also shows information about the columns, the first three columns show the time while the others are the logged channels.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>col_no</p>
</li>
<li>
<p>col_name</p>
</li>
<li>
<p>confidential</p>
</li>
<li>
<p>measured</p>
</li>
<li>
<p>unit</p>
</li>
<li>
<p>category (data type and length)</p>
</li>
<li>
<p>comment</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_amqp_logger">7.2. AMQP Logger</h3>
<div class="sect3">
<h4 id="_general_information_2">7.2.1. General Information</h4>
<div class="paragraph">
<p>The logged OpenMUC-Records are send as JSON to a given AMQP-Broker.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">loggerId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">amqplogger</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph">
<p><a href="#anchor-channel-options">channel options</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingSettings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">amqplogger:queue=&lt;your.queue&gt;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_configuration_2">7.2.2. Configuration</h4>
<div class="paragraph">
<p>You need the following AMQP specific properties for the configuration of the used Broker.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.openmuc.framework.datalogger.amqp.host = localhost
org.openmuc.framework.datalogger.amqp.port = 5672
org.openmuc.framework.datalogger.amqp.ssl = false
org.openmuc.framework.datalogger.amqp.vhost = /
org.openmuc.framework.datalogger.amqp.username = guest
org.openmuc.framework.datalogger.amqp.password = guest</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="amqp-mapping">7.2.3. Mapping to AMQP-Queues</h4>
<div class="paragraph">
<p>Every OpenMUC-Channel will be mapped to an AMQP-Queue with the pattern &lt;framework&gt;&lt;separator&gt;&lt;channelId&gt; in your broker.
They are created automatically after starting OpenMUC. While the &lt;channelId&gt; is set in the channels.xml,
you have to define the name of your framework with the following property additionally.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Set the unique identifier of this framework (this is also the exchange name)
org.openmuc.framework.datalogger.amqp.framework = openmuc</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_serialisation">7.2.4. Serialisation</h4>
<div class="paragraph">
<p>The serialisation is done by another OpenMUC-Bundle. Therefore you have to define which parser should be used. The
serialisation of an OpenMUC-Record to it&#8217;s own JSON format is done with the usage of the default OpenMUC-Parser like in
the example. A custom parser can be used to serialize the record in a custom JSON format, by implementing the parser
interface from the OpenMUC-SPI project according to the Parser-OpenMUC project and use it&#8217;s parser id for this property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Set the parser with which to serialize records
org.openmuc.framework.datalogger.amqp.parser = openmuc</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mqtt_logger">7.3. MQTT Logger</h3>
<div class="sect3">
<h4 id="_general_information_3">7.3.1. General Information</h4>
<div class="paragraph">
<p>Logs OpenMUC records to a MQTT broker. Records are translated to byte messages with the configured ParserService.
The logger implements automatic connection recovery and message buffering.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">loggerId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mqttlogger</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph">
<p><a href="#anchor-channel-options">channel options</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingSettings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mqttlogger:topic=&lt;your/topic&gt;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_installation">7.3.2. Installation</h4>
<div class="paragraph">
<p>To be able to use the logger in the OpenMUC framework you need to modify the <code>conf/bundles.conf.gradle</code> and <code>conf/config.properties</code>
file</p>
</div>
<div class="paragraph">
<p><strong>bundles.conf.gradle</strong></p>
</div>
<div class="paragraph">
<p>Add following dependencies to the <code>bundles.conf.gradle</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  osgibundles group: &quot;org.openmuc.framework&quot;, name: &quot;openmuc-datalogger-mqtt&quot;,                version: openmucVersion
  osgibundles group: &quot;org.openmuc.framework&quot;, name: &quot;openmuc-lib-ssl&quot;,                        version: openmucVersion
  osgibundles group: &quot;org.openmuc.framework&quot;, name: &quot;openmuc-lib-mqtt&quot;,                       version: openmucVersion
  osgibundles group: &quot;org.openmuc.framework&quot;, name: &quot;openmuc-lib-osgi&quot;,                       version: openmucVersion

  //add your project specific bundle here, which provides the ParserService implementation, example with OpenMUC parser:
  osgibundles group: &quot;org.openmuc.framework&quot;, name: &quot;openmuc-lib-parser-openmuc&quot;,            version: openmucVersion</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>config.properties</strong></p>
</div>
<div class="paragraph">
<p>Add following line to <code>config.properties</code> to provide <code>sun.misc</code> package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.osgi.framework.system.packages.extra=sun.misc</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_3">7.3.3. Configuration</h4>
<div id="mqtt-logger-configuration" class="paragraph">
<p>The logger is configured via <a href="#anchor-osgi-dynamic-configuration">dynamic configuration</a></p>
</div>
<div class="listingblock">
<div class="title">org.openmuc.framework.datalogger.mqtt.MqttLogger.cfg</div>
<div class="content">
<pre class="CodeRay highlight"><code># URL of MQTT broker
host=localhost

# port for MQTT communication
port=1883

# (Optional) password of your MQTT account
password=

# (Optional) name of your MQTT account
username=

# identifier of needed parser implementation
parser=openmuc

# directory to store data for file buffering
persistenceDirectory=/data/mqtt/

# file buffering: buffer size in kB
maxBufferSize=1

# file buffering: number of files to be created
maxFileCount=2

#file buffering: file size in kB
maxFileSize=2

# usage of ssl true/false
ssl=false
# if true compose log records of different channels to one mqtt message
multiple=false

# connection retry interval in s  reconnect after given seconds when connection fails
connectionRetryInterval=10

# connection alive interval in s  periodically send PING message to broker to detect broken connections
connectionAliveInterval=10

# (Optional) LWT configuration
# topic on which lastWillPayload will be published
lastWillTopic=
# last will payload
lastWillPayload=
# (Optional) also publish last will payload on client initiated disconnects (true/false)
lastWillAlways=false

# (Optional) &quot;first will&quot; configuration
# topic on which firstWillPayload will be published on successful connections
firstWillTopic=
# first will payload
firstWillPayload=</code></pre>
</div>
</div>
<div class="paragraph">
<p>It relies on a configured <em>key</em> and <em>trust store</em> when using SSL/TLS (see below). Brokers without authentication are
supported, just omit username/password.</p>
</div>
<div class="paragraph">
<p>When the parser supports serializing multiple records at once then <code>multiple</code> can be set true.
Otherwise, every record is sent in a single MQTT message.</p>
</div>
<div class="paragraph">
<p><strong>Enable SSL communication</strong></p>
</div>
<div class="paragraph">
<p>To be able to verify the authenticity of the broker a valid SSL certificate of the broker needs to be added to the TrustStore.
When using 2-way SSL the broker verifies the authenticity of the logger and a valid SSL certificate needs to be added to the KeyStore.</p>
</div>
<div class="paragraph">
<p>OpenMUC ships a <em>key</em> and <em>trust store</em> by default so no creation is necessary. See <a href="#anchor-lib-ssl">SSL Library</a> for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_slotsdb_logger">7.4. SlotsDB Logger</h3>
<div class="sect3">
<h4 id="_general_information_4">7.4.1. General Information</h4>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">loggerId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slotsdb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph">
<p><a href="#anchor-channel-options">channel options</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingSettings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not supported</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_sql_logger">7.5. SQL Logger</h3>
<div class="sect3">
<h4 id="_general_information_5">7.5.1. General Information</h4>
<div class="paragraph">
<p>Writes OpenMUC records to a sql database.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">loggerId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sqllogger</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph">
<p><a href="#anchor-channel-options">channel options</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingSettings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sqllogger:&lt;empty&gt;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_database_schema">7.5.2. Database Schema</h4>
<div class="paragraph">
<p>This logger creates a meta table at the first start, which is named 'openmuc_meta' and contains the
configuration of the logged channels.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">COLOUMN_NAME</th>
<th class="tableblock halign-left valign-top">COLOUMN_TYPE</th>
<th class="tableblock halign-left valign-top">CHARACTER_MAXIMUM_LENGTH</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">channelid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR(30)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logginginterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR(10)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listening</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR(5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A new data table is created for every supported datatype of OpenMUC. All channels of type double are written in a table
with the name 'doublevalue' for example. The schema of this data tables is like the following.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">COLOUMN_NAME</th>
<th class="tableblock halign-left valign-top">DATA_TYPE</th>
<th class="tableblock halign-left valign-top">CHARACTER_MAXIMUM_LENGTH</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp with time zone</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">channelid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">character varying</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">smallint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">numeric</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_installation_2">7.5.3. Installation</h4>
<div class="paragraph">
<p>To be able to use the logger in the OpenMUC framework you need to modify the <code>conf/bundles.conf.gradle</code>.
Different database engines like h2 or postgresql are supported. The needed library bundle depends of the used engine.
Add following dependencies to the <code>bundles.conf.gradle</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  osgibundles group: &quot;org.openmuc.framework&quot;, name: &quot;openmuc-datalogger-sql&quot;,                version: openmucVersion
  osgibundles group: &quot;org.openmuc.framework&quot;, name: &quot;openmuc-lib-osgi&quot;,                       version: openmucVersion

  //add your database engine specific bundle for h2 or postgresql here:
  osgibundles group: 'org.postgresql', name: 'postgresql', version: '42.2.14'
  osgibundles group: 'com.h2database', name: 'h2', version: '1.4.200'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_4">7.5.4. Configuration</h4>
<div class="paragraph">
<p>The logger is configured via <a href="#anchor-osgi-dynamic-configuration">dynamic configuration</a></p>
</div>
<div class="paragraph">
<p>The following properties can be defined at
<code>conf/properties/org.openmuc.framework.datalogger.sql.SqlLoggerService.cfg</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># (Optional) seconds after a timeout is thrown
socket_timeout=5
# Password for postgresql
psql_pass=&lt;pw_postgres&gt;
# Password for the database user
password=&lt;pw_user&gt;
# (Optional) local time zone
timezone=Europe/Berlin
# (Optional) keep tcp connection alive
tcp_keep_alive=true
# User of the used database
user=&lt;database_user&gt;
# (Optional) SSL needed for the database connection
ssl=false
# URL of the used database
#url=jdbc:h2:retry:file:./data/h2/h2;AUTO_SERVER=TRUE;MODE=MYSQL
url=jdbc:postgresql://127.0.0.1:5432/&lt;database_user&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_migrating_database_to_be_compatible_with_newer_h2_version">7.5.5. Migrating database to be compatible with newer H2 version</h4>
<div class="paragraph">
<p>Edit the path and the prefix of the database in the gradle.build file of the sqllogger. Making a Backup of the Database is recommended.
Then run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>openmuc migrateh2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Migrating manually:</p>
</div>
<div class="paragraph">
<p>Download versions 1.4.200 and 2.0.206 from here: <a href="http://www.h2database.com/html/download-archive.html" class="bare">http://www.h2database.com/html/download-archive.html</a> and unpack them.
Copy the Database to another folder and execute the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>java -cp &lt;path to 1.4.200 jar&gt; org.h2.tools.Script -url jdbc:h2:&lt;path to database&gt; -user &lt;username&gt; -password &lt;password&gt; -script &lt;choose a script location path&gt; -options compression zip
java -cp &lt;path to 2.0.206 jar&gt; org.h2.tools.RunScript -url jdbc:h2:&lt;choose path to new database&gt; -user &lt;username&gt; -password &lt;password&gt; -script &lt;script location path&gt; -options compression zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then replace the old Database (or keep it as Backup) with the upgraded one.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="anchor-libraries">8. Libraries</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_amqp_2">8.1. AMQP</h3>
<div id="amqp-lib" class="paragraph">
<p>The AMQP library uses the RabbitMQ Java Client to connect to the broker.</p>
</div>
<div class="paragraph">
<p>The library consists of four classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AmqpSettings</p>
</li>
<li>
<p>AmqpConnection</p>
</li>
<li>
<p>AmqpReader</p>
</li>
<li>
<p>AmqpWriter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It implements automatic connection recovery with message buffering.
If only publishing (or consuming) is needed only the AmqpConnection and the AmqpReader (or AmqpWriter) needs to be instantiated.</p>
</div>
<div class="sect3">
<h4 id="_connecting_to_a_broker_amqpsettingsamqpconnection">8.1.1. Connecting to a broker (AmqpSettings/AmqpConnection)</h4>
<div class="paragraph">
<p>An instance of an AmqpConnection represents a connection to a broker. If multiple connections are needed one can simply create multiple instances.</p>
</div>
<div class="paragraph">
<p>To create an AmqpConnection instance one first needs to create an instance of AmqpSettings and pass it to the constructor of the AmqpConnection. In
that way, it is up to the developer to decide where to get the connection properties from.</p>
</div>
<div class="paragraph">
<p>The connection to the broker is going to be created as soon as the constructor of AmqpConnection is executed.</p>
</div>
<div class="paragraph">
<p>Declaring any queues is not needed as AmqpReader and AmqpWriter do this already.</p>
</div>
<div class="paragraph">
<p>Before the application stops one should <code>disconnect()</code> first to clean up any resources.</p>
</div>
<div class="paragraph">
<p>Example with local RabbitMQ Broker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> host = <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>;
<span class="type">int</span> port = <span class="integer">5672</span>;
<span class="predefined-type">String</span> virtualHost = <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">String</span> username = <span class="string"><span class="delimiter">&quot;</span><span class="content">guest</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">String</span> password = <span class="string"><span class="delimiter">&quot;</span><span class="content">guest</span><span class="delimiter">&quot;</span></span>;
<span class="type">boolean</span> ssl = <span class="predefined-constant">false</span>;
<span class="predefined-type">String</span> exchange = <span class="string"><span class="delimiter">&quot;</span><span class="content">example</span><span class="delimiter">&quot;</span></span>;

AmqpSettings settings = <span class="keyword">new</span> AmqpSettings(
    host, port, virtualHost, username, password, ssl, exchange
);

AmqpConnection connection = <span class="keyword">new</span> AmqpConnection(settings);

<span class="comment">// Before stopping the application:</span>
connection.disconnect();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_consuming_messages_amqpreader">8.1.2. Consuming messages (AmqpReader)</h4>
<div class="paragraph">
<p>To consume messages from the broker one has two options:</p>
</div>
<div class="sect4">
<h5 id="_manually_retrieving_messages">Manually retrieving messages</h5>
<div class="paragraph">
<p>This is the simplest way to get a message. The method <code>byte[] read(String queue)</code> returns a single message retrieved from the given queue or <code>null</code> if the queue was empty.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AmqpReader reader = <span class="keyword">new</span> AmqpReader(connection);
<span class="type">byte</span><span class="type">[]</span> receivedMessage = reader.read(<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleQueue</span><span class="delimiter">&quot;</span></span>);

<span class="keyword">if</span> (receivedMessage == <span class="predefined-constant">null</span>) {
    <span class="comment">// No message received</span>
} <span class="keyword">else</span> {
    <span class="comment">// Handle received message</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_listening_for_messages">Listening for messages</h5>
<div class="paragraph">
<p>This is the recommended way to receive messages, as the messages are received in the moment the broker receives them. One can listen to a collection of queues with a
listener which gets notified when a message in any of those queues is received. When listening to a single queue just pass a collection singleton.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AmqpReader reader = <span class="keyword">new</span> AmqpReader(connection);
<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; queues = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;(<span class="integer">2</span>);
queues.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleQueue1</span><span class="delimiter">&quot;</span></span>);
queues.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleQueue2</span><span class="delimiter">&quot;</span></span>);

reader.listen(queues, (<span class="predefined-type">String</span> queue, <span class="type">byte</span><span class="type">[]</span> message) -&gt; {
    <span class="keyword">if</span> (queue == <span class="string"><span class="delimiter">&quot;</span><span class="content">exampleQueue1</span><span class="delimiter">&quot;</span></span>) {
        <span class="comment">// handle message</span>
    } <span class="keyword">else</span> {
        <span class="comment">// handle message</span>
    }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_publishing_messages_amqpwriter">8.1.3. Publishing messages (AmqpWriter)</h4>
<div class="paragraph">
<p>To publish a message call <code>void write(String routingKey, byte[] message)</code> with the routing key and the message. The message will be published to the exchange specified
in the AmqpConnection.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AmqpWriter writer = <span class="keyword">new</span> AmqpWriter(connection);

<span class="predefined-type">String</span> routingKey = <span class="string"><span class="delimiter">&quot;</span><span class="content">test.logger</span><span class="delimiter">&quot;</span></span>;
<span class="type">byte</span><span class="type">[]</span> message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>.getBytes();
writer.write(routingKey, message);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mqtt_2">8.2. MQTT</h3>
<div id="mqtt-lib" class="paragraph">
<p>The MQTT library uses the HiveMQ MQTT Client to connect to the broker.</p>
</div>
<div class="paragraph">
<p>The library consists of several classes with the most important listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MqttSettings</p>
</li>
<li>
<p>MqttConnection</p>
</li>
<li>
<p>MqttReader</p>
</li>
<li>
<p>MqttWriter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It implements automatic connection recovery with message buffering. Also LWT is supported with additional "first will" feature (see below).
If only publishing (or subscribing) is needed only the MqttConnection and the MqttReader (or MqttWriter) needs to be instantiated.</p>
</div>
<div class="sect3">
<h4 id="_lwt_last_will_and_testament_and_first_will">8.2.1. LWT (Last Will and Testament) and first will</h4>
<div class="paragraph">
<p>The Last Will and Testament feature in the MQTT protocol offers clients an opportunity to send a last will message on a last will topic after ungraceful disconnects.</p>
</div>
<div class="paragraph">
<p>This is achieved by sending a regular MQTT message together with the CONNECT message to the broker.
If the broker detects a broken connection (e.g. no PING message was received after the connection alive interval) it will send the last will payload to all clients subscribed
to the last will message topic.</p>
</div>
<div class="paragraph">
<p>For convenience this library can also send the LWT on intentional disconnects, i.e. when <code>disconnect()</code> is called and LWT is properly configured (with <code>lastWillAlways=true</code>).</p>
</div>
<div class="paragraph">
<p>Also a "first will" is implemented. This is a regular PUBLISH packet sent immediately after the connection is initiated.</p>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_a_broker_mqttsettingsmqttconnection">8.2.2. Connecting to a broker (MqttSettings/MqttConnection)</h4>
<div class="paragraph">
<p>An instance of an MqttConnection represents a connection to a broker. If multiple connections are needed one can simply create multiple instances.</p>
</div>
<div class="paragraph">
<p>To create an MqttConnection instance one first needs to create an instance of MqttSettings and pass it to the constructor of the MqttConnection. In that way, it is up to the
developer to decide where to get the connection properties from.</p>
</div>
<div class="paragraph">
<p>The connection is instantiated when <code>connect()</code> is called. It&#8217;s important to create needed instances of MqttWriter and/or MqttReader <strong>before</strong> calling <code>connect()</code>.</p>
</div>
<div class="paragraph">
<p>Before the application stops one should <code>disconnect()</code> first to clean up any resources.</p>
</div>
<div class="paragraph">
<p>Example with local Mosquitto Broker (with default settings):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> host = <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>;
<span class="type">int</span> port = <span class="integer">1883</span>;
<span class="predefined-type">String</span> user = <span class="predefined-constant">null</span>;
<span class="predefined-type">String</span> pw = <span class="predefined-constant">null</span>;
<span class="type">boolean</span> ssl = <span class="predefined-constant">false</span>;
<span class="type">long</span> maxBufferSize = <span class="integer">1</span>;
<span class="type">long</span> maxFileSize = <span class="integer">2</span>;
<span class="type">int</span> connRetryInterval = <span class="integer">5</span>;
<span class="type">int</span> connAliveInterval = <span class="integer">10</span>;
<span class="predefined-type">String</span> persistenceDirectory = <span class="string"><span class="delimiter">&quot;</span><span class="content">data/mqtt/app</span><span class="delimiter">&quot;</span></span>

MqttSettings settings = <span class="keyword">new</span> MqttSettings(
    host, port, user, pw, ssl, maxBufferSize, maxFileSize, maxFileCount, connRetryInterval,
    connAliveInterval, persistenceDirectory
);

<span class="comment">// Create MqttReader and/or MqttWriter objects here!</span>

MqttConnection connection = <span class="keyword">new</span> MqttConnection(settings);

<span class="comment">// Before stopping the application:</span>
connection.disconnect();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_subscribinglistening_to_topics_mqttreader">8.2.3. Subscribing/listening to topics (MqttReader)</h4>
<div class="paragraph">
<p>One can listen to a collection of topics with a listener which gets notified when a message in any of those topics is received. When listening to a single topic just
pass a collection singleton.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MqttReader reader = <span class="keyword">new</span> MqttReader(connection);
<span class="comment">// Note connect() is called after MqttReader instance creation</span>
connection.connect();
<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; topics = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;(<span class="integer">2</span>);
topics.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">example/topic/1</span><span class="delimiter">&quot;</span></span>);
topics.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">example/topic/2</span><span class="delimiter">&quot;</span></span>);

reader.listen(queues, (<span class="predefined-type">String</span> topic, <span class="type">byte</span><span class="type">[]</span> message) -&gt; {
    <span class="keyword">if</span> (topic == <span class="string"><span class="delimiter">&quot;</span><span class="content">example/topic/1</span><span class="delimiter">&quot;</span></span>) {
        <span class="comment">// handle message</span>
    } <span class="keyword">else</span> {
        <span class="comment">// handle message</span>
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_publishing_messages_mqttwriter">8.2.4. Publishing messages (MqttWriter)</h4>
<div class="paragraph">
<p>To publish a message call <code>void write(String topic, byte[] message)</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MqttWriter writer = <span class="keyword">new</span> MqttWriter(connection);
connection.connect();

<span class="predefined-type">String</span> topic = <span class="string"><span class="delimiter">&quot;</span><span class="content">test/logger</span><span class="delimiter">&quot;</span></span>;
<span class="type">byte</span><span class="type">[]</span> message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>.getBytes();
writer.write(topic, message);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_osgi">8.3. OSGI</h3>
<div id="osgi-lib" class="paragraph">
<p>Bundle: openmuc-lib-osgi</p>
</div>
<div class="paragraph">
<p>This library provides an API to make the usage of OSGi concepts more comfortable.
Main goals are dynamic providing and subscription of OSGi services and their configuration.</p>
</div>
<div class="sect3">
<h4 id="_osgi_service_registration">8.3.1. OSGi Service Registration</h4>
<div class="paragraph">
<p>This section covers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to provide your service to the OSGi service registry?</p>
</li>
<li>
<p>How to subscribe to a service provided by the OSGi service registry?</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_registrationhandler">RegistrationHandler</h5>
<div class="paragraph">
<p>First of all, an instance of RegistrationHandler has to be created. It takes an instance of
org.osgi.framework.BundleContext as parameter, which can be obtained from the activate method.
It is useful to define the RegistrationHandler as global attribute. So it can be used at different points in your code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Activate</span>
<span class="directive">public</span> <span class="type">void</span> activate(BundleContext context) {
    RegistrationHandler registrationHandler = <span class="keyword">new</span> RegistrationHandler(context);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_providing_a_custom_service">Providing a custom service</h5>
<div id="provide-ref" class="paragraph">
<p>For providing a new service class, the following method can be used. The example is based on our AmqpLogger. To use
this method, it is required that your class implements the interface org.osgi.service.cm.ManagedService. Otherwise,
it is impossible to use the dynamic configuration, which is described in the next section.
If you don&#8217;t want to use the dynamic configuration, the RegistrationHandler provides similar methods to provide OSGi
services, which doesn&#8217;t implement the ManagedService interface.<br>
In our case, the first parameter is the class name of the DataLoggerService interface and the second is an instance of the class,
which implements this interface. As third parameter the full qualified class name of our concrete implementation is used
(pid), which is important for the configuration later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> pid = AmqpLogger.class.getName();
registrationHandler.provideInFramework(DataLoggerService.class.getName(), amqpLogger, pid);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_subscribe_for_a_service">Subscribe for a service</h5>
<div class="paragraph">
<p>A subscription for a specific service can be done with the RegistrationHandler as well. The given example subscribes
to all instances of the interface DataLoggerService. Handling of a new received service instance can be
established with a lambda on a very comfortable way. The received instance has the type object and must be casted
in the concrete type. It is advisable to check for null references, because it is possible, that no service
registration exists or the provided service is removed. In this case, a null reference will be received from the
OSGi Service Registry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">registrationHandler.subscribeForService(DataLoggerService.class.getName(), (instance) -&gt; {
    <span class="keyword">if</span> (instance != <span class="predefined-constant">null</span>)
        <span class="local-variable">this</span>.loggerService = (DataLoggerService) instance;
});</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_clean_up">Clean up</h5>
<div class="paragraph">
<p>To keep the OSGi Service Registry clean, it is helpful to remove all provided services and subscriptions, when your
bundle is going down. This can be done in the bundle specific deactivate method, like in the following example.
Call the remove method of our RegistrationHandler. This removes your provided and subscribed services from the
framework and avoids, that code of uninstalled bundles stays in the Service Registry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Deactivate</span>
<span class="directive">public</span> <span class="type">void</span> deactivate()  {
    registrationHandler.removeAllProvidedServices();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_osgi_dynamic_configuration">8.3.2. OSGi Dynamic Configuration</h4>
<div id="anchor-osgi-dynamic-configuration" class="paragraph">
<p>OSGi provides the possibility to change the configuration of bundles at runtime. For this purpose the bundle FileInstall
of the Apache Felix project (<code>org.apache.felix.fileinstall-*.jar</code>) must be added to the framework under framework/conf/bundles.conf.gradle.
It is useful to define a directory where the configuration files will be stored. This can be configured in
<code>conf/system.properties</code> e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>##################### Felix FileInstall
felix.fileinstall.dir=properties
felix.fileinstall.poll=5000</code></pre>
</div>
</div>
<div class="paragraph">
<p>For correct functionality it is important to create a subdirectory under framework/conf/ with the previous defined name,
in this case <code>properties</code>. The following subsections help you to implement dynamic configurations for your service.</p>
</div>
<div class="sect4">
<h5 id="_propertyhandler">PropertyHandler</h5>
<div class="paragraph">
<p>First of all it is required to build a class with all properties of your service, which should be updateable at runtime.
Therefore, the class <code>GenericSettings</code> has to be extended like in this example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Settings</span> <span class="directive">extends</span> GenericSettings {

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> USERNAME = <span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> PASSWORD = <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> PORT = <span class="string"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> HOST = <span class="string"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">public</span> Settings() {
        <span class="local-variable">super</span>();
        properties.put(USERNAME, <span class="keyword">new</span> ServiceProperty(USERNAME, <span class="string"><span class="delimiter">&quot;</span><span class="content">name of your AMQP account</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>, <span class="predefined-constant">true</span>));
        properties.put(PASSWORD, <span class="keyword">new</span> ServiceProperty(PASSWORD, <span class="string"><span class="delimiter">&quot;</span><span class="content">password of your AMQP account</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>, <span class="predefined-constant">true</span>));
        properties.put(PORT, <span class="keyword">new</span> ServiceProperty(PORT, <span class="string"><span class="delimiter">&quot;</span><span class="content">port for AMQP communication</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>, <span class="predefined-constant">true</span>));
        properties.put(HOST, <span class="keyword">new</span> ServiceProperty(HOST, <span class="string"><span class="delimiter">&quot;</span><span class="content">URL of AMQP broker</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Extend the given property map with new instances of the class <code>ServiceProperty</code>. The instantiation needs the key and
description of the property. Furthermore, you can provide a default value and mark the property as optional or mandatory.
The OSGi lib will validate the configuration against the mandatory flag and will report a waring if a mandatory property
is missing.<br>
The next step is to instantiate the <code>PropertyHandler</code> with this settings and the pid which corresponds
to the class implementing the ManagedService. The following examples is based on the AmqpLogger:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AmqpLogger</span> <span class="directive">implements</span> DataLoggerService, ManagedService {

    ...

    public AmqpLogger() {
        <span class="predefined-type">String</span> pid = AmqpLogger.class.getName();
        settings = <span class="keyword">new</span> Settings();
        propertyHandler = <span class="keyword">new</span> PropertyHandler(settings, pid);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>At bundle start a new .cfg file with default values is created in the <code>properties</code> subdirectory e.g.:
<code>org.openmuc.framework.datalogger.amqp.AmqpLogger.cfg</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># name of your AMQP account
username=

# password of your AMQP account
password=

# port for AMQP communication
port=

# URL of AMQP broker
host=localhost</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the .cfg file already exists at bundle start then this file is used and will not be overwritten with default values.
This text file can be edited multiple times at runtime and will be parsed from Apache Felix FileInstall after it is saved.
The file is parsed as an instance of the java type Dictionary and is given to the linked service. This linking is
described in the following subsection.</p>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> If you develop a new service with dynamic configuration, then run the framework once, so that the openmuc-lib-osgi
generates the .cfg file with default values for you. Afterwards, you can edit the file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_managed_service">Managed Service</h5>
<div class="paragraph">
<p>For updating a service class at runtime, it has to implement the interface org.osgi.service.cm.ManagedService.
This interface defines a method <code>public void updated(Dictionary&lt;String, ?&gt; propertyDict)</code>.
Every time the properties in the internal OSGi database for this specific service are updated,
for example through the Apache Felix FileInstall,
the method is called with a new instance of type Dictionary. The linking of this ManagedService with the configuration
file is done by using the same name for the service registration in subsection <a href="#provide-ref">[provide-ref]</a> and
instantiating our <code>PropertyHandler</code>. Because of this, the name of the configuration
file and the full qualified class name are equal.<br>
The given dictionary contains key-value pairs with the properties of the service specific settings class and can be
handled like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> updated(<span class="predefined-type">Dictionary</span>&lt;<span class="predefined-type">String</span>, ?&gt; propertyDict) <span class="directive">throws</span> <span class="exception">ConfigurationException</span> {
    DictionaryPreprocessor dict = <span class="keyword">new</span> DictionaryPreprocessor(propertyDict);
    <span class="keyword">if</span> (!dict.wasIntermediateOsgiInitCall()) {
        tryProcessConfig(dict);
    }
}

<span class="directive">private</span> <span class="type">void</span> tryProcessConfig(DictionaryPreprocessor newConfig) {
    <span class="keyword">try</span> {
        propertyHandler.processConfig(newConfig);
        <span class="keyword">if</span> (propertyHandler.configChanged()) {
            <span class="comment">//Properties are updated, trigger a service specific reaction</span>
        }
    } <span class="keyword">catch</span> (ServicePropertyException e) {
        logger.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">update properties failed</span><span class="delimiter">&quot;</span></span>, e);
        <span class="comment">//Do some reaction till properties are valid again</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> Since the configuration can be changed at any time you need to implement a robust handling of the properties.
Depending on your service you might validate the properties against each other. In general, the user could update
just one property and saves the properties. This could result in a inconsistent property combination. You either make sure
that the user knows that he should change property x, y and z at once or you implement a robust handling (better option).
For example, this could require to close the current communication connection and reconnect with the new properties.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="parser-lib">8.4. Parser-Service</h3>
<div class="paragraph">
<p>The Parser-Service is part of the OpenMUC core SPI bundle and provides methods to serialize and deserialize
OpenMUC records. It is used by the MQTT and AMQP logger but can be also used inside OpenMUC drivers and applications.</p>
</div>
<div class="sect3">
<h4 id="_accessing_a_specific_parser_service">8.4.1. Accessing a specific Parser-Service</h4>
<div class="paragraph">
<p>Bundles implementing the ParserService interface (like the OpenMUC-Parser see below) registering their parserID at the
OSGi service registry. The following code describes, how a Parser-Service and its ID can be accessed. The given
parserID makes it possible to identify the concrete implementation, e.g. "openmuc". Therefore is the instance
of the given BundleContext needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">String serviceInterfaceName = ParserService.class.getName();
ServiceReference<span class="comment">&lt;?&gt; serviceReference = bundleContext.getServiceReference(serviceInterfaceName);

if (serviceReference != null) {
    String parserId = (String) serviceReference.getProperty(&quot;parserID&quot;);
    ParserService parser = (ParserService) bundleContext.getService(serviceReference);
}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively it&#8217;s possible to import and instantiate a Parser-Implementation over the java classpath.
But this increases the dependencies of your bundle and prevents the advantages of OSGi.</p>
</div>
<div class="paragraph">
<p>A more complex example with event based registration can be found in the implementation of the MQTT logger.</p>
</div>
</div>
<div class="sect3">
<h4 id="_openmuc_parser">8.4.2. OpenMUC-Parser</h4>
<div class="paragraph">
<p>The default OpenMUC-Parser is provided in the openmuc-lib-parser-openmuc project. It implements the
ParserService-Interface for serialisation and deserialisation of OpenMUC Records. This services is provided and
can be accessed over the OSGi service registry as shown in the section before.
It registers its service with the value "openmuc" for the property "parserID".
The serialized message is represented in JSON with the following format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">{&quot;timestamp&quot;:1587974340000,&quot;flag&quot;:&quot;VALID&quot;,&quot;value&quot;:6.67}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_parser">8.4.3. Custom Parser</h4>
<div class="paragraph">
<p>For adding a custom parser to OpenMUC, the ParserService-Interface from the SPI-Project has to be implemented. After
this the implementation must be registered in the OSGi service registry. Therefore use the given instance of your
BundleContext.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@Activate
public void activate(BundleContext context) {
    Dictionary<span class="tag">&lt;String</span><span class="error">,</span> <span class="attribute-name">Object</span><span class="tag">&gt;</span> properties = new Hashtable<span class="error">&lt;</span><span class="error">&gt;</span>();
    properties.put(&quot;parserID&quot;, &quot;<span class="tag">&lt;myCustomParser&gt;</span>&quot;);

    String serviceName = ParserService.class.getName();

    registration = context.registerService(serviceName, new MyParserServiceImpl(), properties);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="anchor-lib-ssl">8.5. SSL</h3>
<div class="paragraph">
<p><strong>Key/Trust Store</strong></p>
</div>
<div class="paragraph">
<p>To get the certificates of a server one can easily use a browser and click on the lock sign next to the URL to download it.
Alternatively on *nix one can use the tool openssl:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>openssl s_client -connect host:port -showcerts [-proxy host:port]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the needed certificates into a file i.e. <code>cert.crt</code> (beginning with <code>-----BEGIN CERTIFICATE-----</code> ending with <code>-----END CERTIFICATE-----</code>. Add them to the store:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>keytool -keystore conf/truststore.jks -importcert cert.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default password is <code>changeme</code>. We want to change that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>keytool -keystore conf/truststore.jks -storepasswd</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also import certificates from another store. Prefer importing over just using the other store directly as the store type needs to be <code>PKCS#12</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>keytool -importkeystore -srckeystore otherstore.jks -destkeystore conf/truststore.jks</code></pre>
</div>
</div>
<div class="paragraph">
<p>Editing <code>conf/keystore.jks</code> is done analog to the Trust Store.</p>
</div>
<div class="paragraph">
<p>Edit <code>/conf/system.properties</code> to reflect the changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.openmuc.framework.truststore = conf/truststore.jks
org.openmuc.framework.keystore = conf/keystore.jks
org.openmuc.framework.truststorepassword = changeme
org.openmuc.framework.keystorepassword = changeme</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="anchor-web-ui">9. WebUI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_plugins">9.1. Plugins</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Plotter</dt>
<dd>
<p>Plugin which provides plotter for visualization of current and historical data</p>
</dd>
<dt class="hdlist1">Channel Access Tool</dt>
<dd>
<p>Plugin to show current values of selected channels.
Provides possibility to set values.</p>
</dd>
<dt class="hdlist1">Channel Configurator</dt>
<dd>
<p>Plugin for channel configuration e.g. channel name, sampling interval, logging interval</p>
</dd>
<dt class="hdlist1">Media Viewer</dt>
<dd>
<p>Plugin which allows to embed media files into OpenMUC&#8217;s WebUI</p>
</dd>
<dt class="hdlist1">User Configurator</dt>
<dd>
<p>Plugin for user configuration</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_context_root">9.2. Context Root</h3>
<div class="paragraph">
<p>The servlet context root of the OpenMUC WebUI can be configured, by setting the <code>org.apache.felix.http.context_path</code>
system property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.apache.felix.http.context_path=/muc1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This must be a valid path starting with a slash and not ending with a slash (unless it is the root context).</p>
</div>
</div>
<div class="sect2">
<h3 id="_https">9.3. HTTPS</h3>
<div class="paragraph">
<p>You can access the WebUI over https as well:
<a href="https://localhost:8889" class="bare">https://localhost:8889</a>. To make the framework more secure you could disable http by setting org.apache.felix.http.enable in the conf/system.properties file to false.</p>
</div>
</div>
<div class="sect2">
<h3 id="_custom_plugins">9.4. Custom Plugins</h3>
<div class="paragraph">
<p>You can include your own Plugins in the OpenMUC WebUI by creating a java class that extends the WebUiPluginService.
This class also has to be annotated as a component.
The two functions getAlias and getName have to be overridden.
The alias is used to identify the plugin while the name will be displayed in the WebUI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>(service = WebUiPluginService.class)
<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">SamplePlugin</span> <span class="directive">extends</span> WebUiPluginService {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getAlias() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">sampleplugin</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Sample Plugin</span><span class="delimiter">&quot;</span></span>;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to display an icon above the plugins name, the file needs to be called icon and saved under <code>samplePlugin/src/main/resources/images</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_visualisation">9.5. Visualisation</h3>
<div class="paragraph">
<p>First you need a svg and assign all the svg Elements a unique id.
You can include an external svg as an Object Element or you can create the svg directly in html.
Either way the Element containing the svg needs an id which you can then use to access the svg in javascript.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">svg_document = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">samplePluginGraphic</span><span class="delimiter">'</span></span>).contentDocument;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can manipulate the Elements of the svg, the easiest way to do this is through getElementById for a single Element or getElementsByClass for multiple Elements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">sampleText = svg_document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">sampleTextField</span><span class="delimiter">&quot;</span></span>);
sampleText.textContent = channel.record.value;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aside from changing what is displayed you can also manipulate the css in this way.
The following example would change the displayed texts color to blue.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">sampleText.style.fill = <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="id_restful_web_services">10. REST Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The openmuc-server-restws bundle manages a RESTful web service to access all registered channels of the framework.
The RESTful web service is accessed by the same port as the web interface mentioned in Chapter 2.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The address to access the web service using the provided demo/framework folder is 'http://localhost:8888/rest/'
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_requirements">10.1. Requirements</h3>
<div class="paragraph">
<p>In order to start the RESTful web service, the following bundle must be provided:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bundle that provides an org.osgi.service.http.HttpService service.
In the demo framework, that service is provided by the org.apache.felix.http.jetty bundle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This bundles is already provided by the demo framework.
The RESTful web service will start automatically with the framework without additional settings.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_channels">10.2. Accessing channels</h3>
<div class="paragraph">
<p>The latest record of a single channel can be accessed, by sending a GET request at the address:
'http://server-address/rest/channels/{id}' where {id} is replaced with the actual channel ID.
The result will be latest record object of the channel encoded in JSON with the following structure:</p>
</div>
<div class="listingblock">
<div class="title">Record JSON</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">timestamp</span><span class="delimiter">&quot;</span></span> : <span class="error">t</span><span class="error">i</span><span class="error">m</span><span class="error">e</span><span class="error">_</span><span class="error">v</span><span class="error">a</span><span class="error">l</span>, <span class="error">/</span><span class="error">*</span><span class="error">m</span><span class="error">i</span><span class="error">l</span><span class="error">l</span><span class="error">i</span><span class="error">s</span><span class="error">e</span><span class="error">c</span><span class="error">o</span><span class="error">n</span><span class="error">d</span><span class="error">s</span> <span class="error">s</span><span class="error">i</span><span class="error">n</span><span class="error">c</span><span class="error">e</span> <span class="error">U</span><span class="error">n</span><span class="error">i</span><span class="error">x</span> <span class="error">e</span><span class="error">p</span><span class="error">o</span><span class="error">c</span><span class="error">h</span><span class="error">*</span><span class="error">/</span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">flag</span><span class="delimiter">&quot;</span></span> : <span class="error">f</span><span class="error">l</span><span class="error">a</span><span class="error">g</span><span class="error">_</span><span class="error">v</span><span class="error">a</span><span class="error">l</span>,      <span class="error">/</span><span class="error">*</span><span class="error">s</span><span class="error">t</span><span class="error">a</span><span class="error">t</span><span class="error">u</span><span class="error">s</span> <span class="error">f</span><span class="error">l</span><span class="error">a</span><span class="error">g</span> <span class="error">o</span><span class="error">f</span> <span class="error">t</span><span class="error">h</span><span class="error">e</span> <span class="error">r</span><span class="error">e</span><span class="error">c</span><span class="error">o</span><span class="error">r</span><span class="error">d</span> <span class="error">a</span><span class="error">s</span> <span class="error">s</span><span class="error">t</span><span class="error">r</span><span class="error">i</span><span class="error">n</span><span class="error">g</span><span class="error">*</span><span class="error">/</span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span> : <span class="error">v</span><span class="error">a</span><span class="error">l</span><span class="error">u</span><span class="error">e</span><span class="error">_</span><span class="error">v</span><span class="error">a</span><span class="error">l</span>     <span class="error">/</span><span class="error">*</span><span class="error">a</span><span class="error">c</span><span class="error">t</span><span class="error">u</span><span class="error">a</span><span class="error">l</span> <span class="error">v</span><span class="error">a</span><span class="error">l</span><span class="error">u</span><span class="error">e</span><span class="error">.</span> <span class="error">O</span><span class="error">m</span><span class="error">i</span><span class="error">t</span><span class="error">t</span><span class="error">e</span><span class="error">d</span> <span class="error">i</span><span class="error">f</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">flag</span><span class="delimiter">&quot;</span></span> <span class="error">!</span><span class="error">=</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">valid</span><span class="delimiter">&quot;</span></span><span class="error">*</span><span class="error">/</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access logged values of a channel by adding '/history?from=fromTimestamp&amp;until=untilTimestamp' to the channel address, fromTimestamp and untilTimestamp are both milliseconds since Unix epoch (1970-01-01 00:00:00).
The result is a collection of records encoded as JSON.</p>
</div>
<div class="paragraph">
<p>Additionally, the records off all available channels can be read in one go, by omitting the ID from the address.
The result is a collection of channel objects encoded in JSON using this structure:</p>
</div>
<div class="listingblock">
<div class="title">ChannelCollection JSON</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
    {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> : <span class="error">c</span><span class="error">h</span><span class="error">a</span><span class="error">n</span><span class="error">n</span><span class="error">e</span><span class="error">l</span><span class="integer">1</span><span class="error">_</span><span class="error">i</span><span class="error">d</span>,  <span class="error">/</span><span class="error">*</span><span class="error">I</span><span class="error">D</span> <span class="error">o</span><span class="error">f</span> <span class="error">t</span><span class="error">h</span><span class="error">e</span> <span class="error">c</span><span class="error">h</span><span class="error">a</span><span class="error">n</span><span class="error">n</span><span class="error">e</span><span class="error">l</span> <span class="error">a</span><span class="error">s</span> <span class="error">s</span><span class="error">t</span><span class="error">r</span><span class="error">i</span><span class="error">n</span><span class="error">g</span><span class="error">*</span><span class="error">/</span>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">record</span><span class="delimiter">&quot;</span></span> : <span class="error">c</span><span class="error">h</span><span class="error">a</span><span class="error">n</span><span class="error">n</span><span class="error">e</span><span class="error">l</span><span class="integer">1</span><span class="error">_</span><span class="error">r</span><span class="error">e</span><span class="error">c</span><span class="error">o</span><span class="error">r</span><span class="error">d</span> <span class="error">/</span><span class="error">*</span><span class="error">c</span><span class="error">u</span><span class="error">r</span><span class="error">r</span><span class="error">e</span><span class="error">n</span><span class="error">t</span> <span class="error">r</span><span class="error">e</span><span class="error">c</span><span class="error">o</span><span class="error">r</span><span class="error">d</span><span class="error">.</span> <span class="error">s</span><span class="error">e</span><span class="error">e</span> <span class="error">R</span><span class="error">e</span><span class="error">c</span><span class="error">o</span><span class="error">r</span><span class="error">d</span> <span class="error">J</span><span class="error">S</span><span class="error">O</span><span class="error">N</span><span class="error">*</span><span class="error">/</span>
    },
    {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> : <span class="error">c</span><span class="error">h</span><span class="error">a</span><span class="error">n</span><span class="error">n</span><span class="error">e</span><span class="error">l</span><span class="integer">2</span><span class="error">_</span><span class="error">i</span><span class="error">d</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">record</span><span class="delimiter">&quot;</span></span> : <span class="error">c</span><span class="error">h</span><span class="error">a</span><span class="error">n</span><span class="error">n</span><span class="error">e</span><span class="error">l</span><span class="integer">2</span><span class="error">_</span><span class="error">r</span><span class="error">e</span><span class="error">c</span><span class="error">o</span><span class="error">r</span><span class="error">d</span>
    }
    <span class="error">.</span><span class="error">.</span><span class="error">.</span>
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>New records can be written to channels by sending a PUT request at the address that represents a channel.
The data in the put request is a record encoded as specified in Record JSON above.</p>
</div>
<div class="paragraph">
<p>If HTTPS is used to access the REST server then HTTP basic authentication is required.
The login credentials are the same as the one used to log into the web interface of the OpenMUC Framework.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cors">10.3. CORS</h3>
<div class="paragraph">
<p>The rest Server has the ability to handle CORS(Cross-Origin Resource Sharing).
CORS is explained in detail <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">here</a>.
Typically this functionality is needed when your browser sends an OPTIONS request instead of the request (f.e. GET, POST etc.) that you intended to send.
Per default CORS is is deactivated for the rest Server.
The functionality can be activated via the system.properties file located in the openmuc/framework/conf/ directory.
If the following lines are not there add them.</p>
</div>
<div class="listingblock">
<div class="title">system.properties</div>
<div class="content">
<pre># Activate CORS functionality for the rest Server
org.openmuc.framework.server.restws.enable_cors = true

# Origins and methods for CORS , for each origin semicolon separated
org.openmuc.framework.server.restws.url_cors = http://localhost:4200; http://localhost:8456
org.openmuc.framework.server.restws.methods_cors = GET, PUT; POST
org.openmuc.framework.server.restws.headers_cors = Authorization, Content-Type; Authorization</pre>
</div>
</div>
<div class="paragraph">
<p>The variable enable_cors activates or deactivates the support for CORS.
The variables for url_cors, methods_cors, header_cors defines the allowed origins and the methods these origins are allowed to send to the server.
Multiple origins are semicolon separated with the methods and headers separated by the same order as the origins.
The methods and headers for each origin are then separated by comma.
This means that in the above example the origin:</p>
</div>
<div class="paragraph">
<p><a href="http://localhost:4200" class="bare">http://localhost:4200</a> is a trusted origin which is allowed to send GET and PUT requests and uses the headers Authorization and Content-Type.<br>
<a href="http://localhost:8456" class="bare">http://localhost:8456</a> is a trusted origin which is allowed to send POST requests and uses the header Authorization.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="id_modbus_service">11. Modbus Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The modus service allows you to access to a OpenMUC channel by ModbusTCP protocol.
For accessing a channel through Modbus the channel has to be mapped with <em>serverMapping</em> and the Modbus Server bundle has to copied in the bundle folder.</p>
</div>
<div class="paragraph">
<p>ServerMapping ID: <em>modbus</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. serverMapping</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Primary Table</th>
<th class="tableblock halign-center valign-top">BOOLEAN</th>
<th class="tableblock halign-center valign-top">SHORT</th>
<th class="tableblock halign-center valign-top">INT</th>
<th class="tableblock halign-center valign-top">FLOAT</th>
<th class="tableblock halign-center valign-top">DOUBLE</th>
<th class="tableblock halign-center valign-top">LONG</th>
<th class="tableblock halign-center valign-top">BYTEARRAY[n]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INPUT_REGISTER</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HOLDING_REGISTERS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>DISCRETE_INPUTS and COIL are not supported yet.</p>
</div>
<div class="paragraph">
<div class="title">Server Settings</div>
<p>Server settings are done in the <em>load/org.openmuc.framework.server.modbus.ModbusServer.cfg</em>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. <strong>Server settings</strong></caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">127.0.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address to listen on</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">poolsize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>int</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listener thread pool size, only has affects with TCP and RTUTCP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>int</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">502</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to listen on</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unitId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>int</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UnitId of the slave</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tcp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection type (TCP, RTUTCP or UDP)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you run ModbusTCP Server without root-privileges you have to allow Felix to bind Port 502 with setcap.</p>
</div>
<div class="listingblock">
<div class="title">Console e.g. bash</div>
<div class="content">
<pre>setcap 'cap_net_bind_service=+ep' /path/to/program</pre>
</div>
</div>
<div class="sect2">
<h3 id="_example">11.1. Example</h3>
<div class="listingblock">
<div class="title">channels.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>
<span class="tag">&lt;configuration&gt;</span>

  <span class="tag">&lt;driver</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">virtual</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;device</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sample_device</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sample_channel_1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;serverMapping</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">modbus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>HOLDING_REGISTERS:1000:INTEGER<span class="tag">&lt;/serverMapping&gt;</span>
        <span class="tag">&lt;valueType&gt;</span>INTEGER<span class="tag">&lt;/valueType&gt;</span>
      <span class="tag">&lt;/channel&gt;</span>

      <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sample_channel_2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;serverMapping</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">modbus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>HOLDING_REGISTERS:1002:BOOLEAN<span class="tag">&lt;/serverMapping&gt;</span>
        <span class="tag">&lt;valueType&gt;</span>BOOLEAN<span class="tag">&lt;/valueType&gt;</span>
      <span class="tag">&lt;/channel&gt;</span>

      <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sample_channel_3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;serverMapping</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">modbus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>INPUT_REGISTERS:1000:DOUBLE<span class="tag">&lt;/serverMapping&gt;</span>
      <span class="tag">&lt;/channel&gt;</span>

      <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sample_channel_4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;serverMapping</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">modbus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>INPUT_REGISTERS:1004:LONG<span class="tag">&lt;/serverMapping&gt;</span>
        <span class="tag">&lt;valueType&gt;</span>LONG<span class="tag">&lt;/valueType&gt;</span>
      <span class="tag">&lt;/channel&gt;</span>

    <span class="tag">&lt;/device&gt;</span>
  <span class="tag">&lt;/driver&gt;</span>

<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">system.properties</div>
<div class="content">
<pre>org.openmuc.framework.server.modbus.address=127.0.0.1
org.openmuc.framework.server.modbus.port=5502
org.openmuc.framework.server.modbus.unitId=1
org.openmuc.framework.server.modbus.master=false</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tools">12. Tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apache_felix_web_console">12.1. Apache Felix Web Console</h3>
<div class="paragraph">
<p>The Apache Felix Web Console is a Web Based Management Console for OSGi Frameworks. You can use it e.g. for managing your OpenMUC framework
bundle during runtime. For more information about the Web Console read the <a href="https://felix.apache.org/documentation/subprojects/apache-felix-web-console.html">Felix Apache documentation</a>.
With this console you can also configure the configuration of all bundles which are using the openmuc-lib-osgi bundle or reconfigure the .</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/apache-console-bundle-list.png"><img src="./images/apache-console-bundle-list.png" alt="apache console bundle list" width="60%"></a>
</div>
<div class="title">Figure 13. Apache Felix Web Console Bundles List</div>
</div>
<div class="paragraph">
<p>The default local link to the console is <a href="http://127.0.0.1:8888/system/console">http://127.0.0.1:8888/system/console</a>, the credentials are the same like in OpenMUC WebUI.</p>
</div>
<div class="sect3">
<h4 id="_dependencies">12.1.1. Dependencies</h4>
<div class="paragraph">
<p>You need the following bundles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  osgibundles group: "org.apache.felix",     name: "org.apache.felix.webconsole",           version: "4.5.4"
  osgibundles group: "commons-io",           name: "commons-io",                            version: "2.6"
  osgibundles group: "commons-fileupload",   name: "commons-fileupload",                    version: "1.4"
  osgibundles group: "commons-codec",        name: "commons-codec",                         version: "1.14"</pre>
</div>
</div>
<div class="paragraph">
<p>These bundles are already integrated in the demo framework.
For additional functionality you can add further apache felix web console plugins.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authors">13. Authors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Developers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dirk Zimmermann</p>
</li>
<li>
<p>Marco Mittelsdorf</p>
</li>
<li>
<p>Joern Schumann</p>
</li>
<li>
<p>Martin Eberle</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Former developers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Stefan Feuerhahn</p>
</li>
<li>
<p>Albrecht Schall</p>
</li>
<li>
<p>Michael Zillgith</p>
</li>
<li>
<p>Karsten Mller-Bier</p>
</li>
<li>
<p>Simon Fey</p>
</li>
<li>
<p>Frederic Robra</p>
</li>
<li>
<p>Philipp Fels</p>
</li>
<li>
<p>Chris Dieter Medam</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-03-31 13:01:59 +0200
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>